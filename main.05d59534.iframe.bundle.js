(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"./.storybook/global.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./.storybook/global.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./.storybook/preview.js-generated-config-entry.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var preview_namespaceObject={};__webpack_require__.r(preview_namespaceObject);__webpack_require__("./node_modules/core-js/modules/es.object.keys.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.js"),__webpack_require__("./node_modules/core-js/modules/es.array.filter.js"),__webpack_require__("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),__webpack_require__("./node_modules/core-js/modules/es.array.for-each.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.for-each.js"),__webpack_require__("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),__webpack_require__("./node_modules/core-js/modules/es.object.define-properties.js"),__webpack_require__("./node_modules/core-js/modules/es.object.define-property.js");var ClientApi=__webpack_require__("./node_modules/@storybook/client-api/dist/esm/ClientApi.js");__webpack_require__("./.storybook/global.css");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.keys(preview_namespaceObject).forEach((function(key){var value=preview_namespaceObject[key];switch(key){case"args":return Object(ClientApi.d)(value);case"argTypes":return Object(ClientApi.b)(value);case"decorators":return value.forEach((function(decorator){return Object(ClientApi.f)(decorator,!1)}));case"loaders":return value.forEach((function(loader){return Object(ClientApi.g)(loader,!1)}));case"parameters":return Object(ClientApi.h)(function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},value),!1);case"argTypesEnhancers":return value.forEach((function(enhancer){return Object(ClientApi.c)(enhancer)}));case"argsEnhancers":return value.forEach((function(enhancer){return Object(ClientApi.e)(enhancer)}));case"render":return Object(ClientApi.i)(value);case"globals":case"globalTypes":var v={};return v[key]=value,Object(ClientApi.h)(v,!1);case"__namedExportsOrder":case"decorateStory":case"renderToDOM":return null;default:return console.log(key+" was not supported :( !")}}))},"./generated-stories-entry.js":function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js").configure)([__webpack_require__("./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.tsx)$")],module,!1)}).call(this,__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/webpack/buildin/module.js")(module))},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./.storybook/global.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".sb-show-main {\n  display: grid !important;\n}\n\n#root {\n  height: 100%;\n}",""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/align.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,"#drawing-panel {\n  height: 100%;\n  width: 100%;\n}\n\n.drawing-panel-float {\n  box-shadow: 0 1px 2px -2px #00000029, 0 3px 6px #0000001f, 0 5px 12px 4px #00000017;\n  transition: transform 1s, box-shadow 3s ease-in-out;\n}\n\n.drawing-panel-float:hover {\n  box-shadow: -15px 0 200px -50px #e9896277, 0 0 200px -50px #fe19c877, 15px 0 200px -50px #9425c977;\n}\n\n#canvas-container {\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\n#c {\n  width: 100%;\n  height: 100%;\n\n  position: absolute;\n\n  bottom: 0px;\n  top: 0px;\n}\n\n#text {\n  width: 100%;\n  height: 100%;\n\n  position: absolute;\n\n  bottom: 0px;\n  top: 0px;\n}\n\n#draw-shapes {\n  width: 100%;\n  height: 100%;\n  display: block;\n  position: absolute;\n  left: 0px;\n  top: 0px;\n}\n\n.noselect {\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Safari */\n  /* Konqueror HTML */\n  -moz-user-select: none;\n  /* Old versions of Firefox */\n  /* Internet Explorer/Edge */\n  user-select: none;\n  /* Non-prefixed version, currently\n  supported by Chrome, Opera and Firefox */\n}\n\n.dragOver {\n  border: 3px dashed var(--color-warmblue);\n}\n\n/* Prim Chip */\n.prim-chip {\n  color: var(--color-grey5);\n  padding: 1px 8px 3px;\n  background-color: var(--color-warmblue0);\n  border-radius: 100px;\n  display: flex;\n  width: -moz-fit-content;\n  width: fit-content;\n  border-width: 1px;\n  border-style: solid;\n  border-color: var(--color-warmblue0);\n  cursor: pointer;\n}\n\n.prim-chip:hover {\n  background-color: var(--color-warmblue);\n  border-color: var(--color-warmblue);\n  color: var(--color-grey1);\n}\n\n.prim-chip-selected {\n  background-color: var(--color-warmblue);\n  border-color: var(--color-warmblue);\n  color: var(--color-grey1);\n}\n\n.prim-chip-selected:hover {\n  background-color: var(--color-warmblue0);\n  border-color: var(--color-warmblue0);\n  color: var(--color-grey5);\n}",""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/buttons.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,'.button {\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  cursor: pointer;\n  appearance: none;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--color-warmblue);\n  color: white;\n  font-family: var(--font-display);\n  margin: 0;\n  border: 1px solid var(--color-grey1);\n  border-radius: 4px;\n  box-shadow: 0 var(--shadow-size) 0 0 var(--shadow-color);\n  outline-offset: 2px;\n  transform: translateY(0);\n  transition: background-color 50ms ease-out,\n    box-shadow 50ms ease-out,\n    transform 100ms cubic-bezier(0.3, 0.6, 0.8, 1.25);\n}\n\n\n.button:hover {\n  border-color: var(--color-warmblue);\n  text-decoration: none;\n  box-shadow: 0 -1px 10px rgb(0 0 0 / 5%), 0 1px 4px rgb(0 0 0 / 10%), 0 10px 30px #f3ece8;\n  transform: translateY(-1px);\n}\n\n.button:active {\n  --press: 2px;\n  box-shadow: 0 -1px 10px rgb(0 0 0 / 5%), 0 1px 4px rgb(0 0 0 / 10%), 0 10px 30px #f3ece8;\n  transform: translateY(var(--press));\n}\n\nbutton:disabled,\nbutton[disabled],\n.button[disabled],\n.button[aria-disabled="true"] {\n  transform: translateY(0);\n  /* pointer-events: none; */\n  cursor: not-allowed;\n}\n\nbutton:disabled:hover,\nbutton[disabled]:hover,\n.button[disabled]:hover,\n.button[aria-disabled="true"]:hover {\n  color: unset;\n}\n\n.button:focus:not(:focus-visible) {\n  outline: none;\n}\n\n.color-swatch-button {\n  width: 22px;\n  height: 22px;\n  border-radius: 4px;\n  border: 1px solid var(--color-grey5);\n  transition: transform 50ms ease-in-out;\n}\n\n.color-swatch-button:hover {\n  border-color: var(--color-warmblue);\n  transform: translateY(-1px);\n  cursor: pointer;\n}\n\n.color-swatch-button:disabled {\n  transform: translateY(0px);\n  cursor: not-allowed;\n}\n\n.color-swatch-button-active {\n  border-color: var(--color-warmblue);\n}\n\n.color-picker .react-colorful__saturation {\n  border-radius: 0px;\n}\n\n.color-picker .react-colorful__hue {\n  border-radius: 0px 0px 4px 4px;\n}\n\n.primary-button {\n  background-color: var(--color-grey1);\n  border-color: var(--color-warmblue);\n  border-width: 2px;\n  border-radius: 9999px;\n  border-style: solid;\n  padding: 0.45rem 0.7rem;\n  font-size: 0.95rem;\n  font-weight: bold;\n  color: var(--color-warmblue);\n  cursor: pointer;\n}\n\n.primary-button:hover {\n  color: var(--color-grey1);\n  background-color: var(--color-warmblue);\n  border-color: var(--color-grey1);\n}\n\n.secondary-button {\n  background-color: var(--color-grey1);\n  border-color: var(--color-warmblue);\n  border-width: 2px;\n  border-radius: 2px;\n  border-style: solid;\n  padding: 0.5rem .75rem;\n  font-size: 1rem;\n  font-weight: bold;\n  color: var(--color-warmblue);\n  cursor: pointer;\n}\n\n.secondary-button:hover {\n  color: var(--color-grey1);\n  background-color: var(--color-warmblue);\n  border-color: var(--color-grey1);\n}\n\n/* Icon Button */\n.icon-button {\n  width: 32px;\n  min-width: 32px;\n  max-width: 32px;\n  height: 32px;\n  min-height: 32px;\n  max-height: 32px;\n  padding: 0px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-warmblue);\n  background-color: var(--color-grey1);\n  border-width: 1px;\n  border-style: solid;\n  border-color: var(--color-warmblue);\n  cursor: pointer;\n}\n\n.icon-button:hover {\n  border-color: var(--color-warmblue);\n  color: var(--color-warmblue);\n}\n\n.icon-button:active {\n  border-color: var(--color-warmblue);\n  background-color: var(--color-warmblue);\n  color: var(--color-grey1);\n}\n\n/* Icon Solo Button */\n.icon-solo-button {\n  width: 24px;\n  min-width: 24px;\n  max-width: 24px;\n  height: 24px;\n  min-height: 24px;\n  max-height: 24px;\n  padding: 0px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--color-grey4);\n  background-color: var(--color-grey1);\n  border: none;\n  cursor: pointer;\n}\n\n.icon-solo-button:hover {\n  color: var(--color-warmblue);\n}\n\n.icon-solo-button:active {\n  background-color: var(--color-warmblue);\n  color: var(--color-grey1);\n}\n\n/* Tab Button */\n.tab-button {\n  flex: 1 1;\n  font-size: 1.125rem;\n  font-weight: 600;\n  color: var(--color-grey4);\n  background-color: var(--color-grey1);\n  border: none;\n  padding: 16px 0px 14px;\n  border-bottom: 2px solid var(--color-grey1);\n}\n\n.tab-button:hover {\n  color: var(--color-warmblue);\n  border-bottom: 2px solid var(--color-warmblue);\n}\n\n.tab-button:active {\n  color: var(--color-warmblue);\n  border-bottom: 2px solid var(--color-warmblue);\n}\n\n.tab-button-active {\n  color: var(--color-warmblue);\n  border-bottom: 2px solid var(--color-warmblue);\n}\n\n/* Call to Action */\n.call-to-action:after {\n  content: \'Ask a Question\';\n}\n\n.call-to-action:hover:after {\n  content: \'Get an Answer\';\n}\n\n/* Post Voter */\n.post-voter-button {\n  border: none;\n  background-color: rgba(0, 0, 0, 0);\n  color: var(--color-grey5);\n  font-size: 2rem;\n  padding: 4px;\n  display: flex;\n  cursor: pointer;\n}\n\n.post-voter-button:hover {\n  color: var(--color-warning);\n}\n\n/* Switch */\n.switch-root {\n  display: flex;\n  align-items: center;\n  width: 42px;\n  height: 25px;\n  background-color: var(--color-grey4);\n  border-radius: 999px;\n  position: relative;\n  box-shadow: 0px 2px 2px var(--color-warmblue0);\n  border: 1px solid var(--color-warmblue);\n}\n\n.switch-root:focus {\n  box-shadow: 0 0 0 2px var(--color-grey3);\n}\n\n.switch-root[data-state="checked"] {\n  background-color: var(--color-grey3);\n}\n\n.switch-thumb {\n  display: block;\n  width: 21px;\n  height: 21px;\n  background-color: var(--color-grey1);\n  border-radius: 999px;\n  box-shadow: 0px 2px 2px var(--color-grey3);\n  transition: transform 100ms;\n  transform: translateX(-6px);\n  will-change: transform;\n}\n\n.switch-thumb:focus {\n  border: 1px solid var(--color-warmblue);\n}\n\n.switch-thumb[data-state="checked"] {\n  transform: translateX(13px);\n}',""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/editor.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".toolbar {\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  gap: 0.5rem;\n  padding: 0.5rem 1rem;\n  border-bottom: 1px solid var(--color-grey3);\n  justify-content: space-between;\n}\n\n.toolbar:first-child {\n  margin-left: 0px;\n}\n\n.toolbar:last-child {\n  margin-right: 0px;\n}\n\n.toolbar-button {\n  color: var(--color-warmblue);\n  background-color: var(--color-grey1);\n  border-color: var(--color-warmblue);\n  border-width: 1px;\n  border-radius: 4px;\n  border-style: solid;\n  padding: 0.375rem;\n}\n\n.toolbar-button:hover {\n  color: var(--color-grey1);\n  background-color: var(--color-warmblue);\n  cursor: pointer;\n}\n\n.toolbar-button:disabled {\n  color: var(--color-grey4);\n  background-color: var(--color-grey1);\n  cursor: not-allowed;\n  border-color: var(--color-grey4);\n}\n\n.toolbar-button:hover:disabled {\n  color: var(--color-grey4);\n}\n\n.confirm {\n  background-color: var(--color-warmblue1);\n}\n\n.toolbar-cancel {\n  color: var(--color-invalid);\n  background-color: var(--color-invalid0);\n  border-color: var(--color-invalid);\n}\n\n.toolbar-cancel:hover {\n  color: var(--color-invalid0);\n  background-color: var(--color-invalid);\n  cursor: pointer;\n}\n\n.active {\n  color: var(--color-grey1);\n  background-color: var(--color-warmblue);\n}\n\n.toolbar-icon {\n  width: -moz-fit-content;\n  width: fit-content;\n  height: -moz-fit-content;\n  height: fit-content;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\ndiv[role=group]>button {\n  border-radius: 0px;\n  border-left: none;\n}\n\ndiv[role=group]>button:first-of-type {\n  border-top-left-radius: 4px;\n  border-bottom-left-radius: 4px;\n  border-left: 1px solid var(--color-warmblue);\n}\n\ndiv[role=group]>button:disabled:first-of-type {\n  border-left-color: var(--color-grey4);\n}\n\ndiv[role=group]>button:last-of-type {\n  border-top-right-radius: 4px;\n  border-bottom-right-radius: 4px;\n  border-right: 1px solid var(--color-warmblue);\n}\n\ndiv[role=group]>button:disabled:last-of-type {\n  border-right-color: var(--color-grey4);\n}\n\n/* dropdown */\n.dropdown-trigger {\n  display: flex;\n  align-items: baseline;\n  justify-content: center;\n  border-radius: 4px;\n  padding: 4px 10px;\n  background-color: rgba(0, 0, 0, 0);\n  font-weight: 700;\n  font-size: 1rem;\n  border: none;\n  gap: 8px;\n}\n\n.dropdown-trigger:hover {\n  background-color: var(--color-warmblue1);\n}\n\n.dropdown-content {\n  width: -moz-fit-content;\n  width: fit-content;\n  background-color: var(--color-grey1);\n  border: 1px solid var(--color-warmblue);\n  border-radius: 4px;\n  padding: 6px 6px;\n  box-shadow: rgba(0, 0, 0, 0.08) 0px 8px 28px;\n}\n\n.dropdown-item {\n  color: var(--color-warmblue);\n  display: flex;\n  flex-direction: row;\n  gap: 8px;\n  border-radius: 2px;\n  padding: 2px 6px;\n  transition: background-color 0.01s ease-in-out, color 0.01s ease-in-out;\n  font-size: 0.85rem;\n}\n\n.dropdown-item:hover {\n  background-color: var(--color-warmblue);\n  color: var(--color-grey1);\n  cursor: pointer;\n}\n\n.dropdown-item:hover[data-disabled] {\n  background-color: var(--color-grey1);\n  color: var(--color-grey3);\n  cursor: not-allowed;\n}\n\n.dropdown-item[data-disabled] {\n  color: var(--color-grey3);\n}",""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/flex.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".flex-container {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  align-items: baseline;\n  gap: 24px;\n}\n\n.flex-row {\n  height: -moz-fit-content;\n  height: fit-content;\n  width: 100%;\n  display: flex;\n  align-items: baseline;\n  gap: 24px;\n  flex-direction: row;\n}\n\n.flex-column {\n  height: -moz-fit-content;\n  height: fit-content;\n  width: 100%;\n  display: flex;\n  align-items: baseline;\n  gap: 24px;\n  flex-direction: column;\n}",""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/global.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,':root {\n  --color-invalid: #f53d5f;\n  --color-invalid0: hsl(349, 73%, 94%);\n  --color-warning: #ff7942;\n  --color-offwhite: #fefcf9;\n  --color-paleyellow: #fefbe4;\n  --color-fuckyeahyellow: #ffd504;\n  --color-warmblue0: #e9ecf9;\n  --color-warmblue1: #c3cef2;\n  --color-warmblue: #375fe5;\n  --color-violet: #9425c9;\n  --color-galaxy: #3f1045;\n  --color-zap: #b9f94d;\n  --color-green: #56bb66;\n  --color-grey1: hsl(210, 17%, 98%);\n  --color-grey2: hsl(0, 0%, 95%);\n  --color-grey3: hsl(210, 18%, 84%);\n  --color-grey4: hsl(206, 6%, 56%);\n  --color-grey5: hsl(261, 3%, 30%);\n  --color-grey6: hsl(204, 33%, 9%);\n  --font-body: -apple-system, "Segoe UI", Helvetica Neue, Helvetica,\n    Roboto, Arial, sans-serif, system-ui, "Apple Color Emoji",\n    "Segoe UI Emoji";\n  --border-radius-01: 2px;\n  --border-radius-02: 4px;\n}\n\nhtml {\n  box-sizing: border-box;\n  height: 100%;\n}\n\n*,\n*::before,\n*::after {\n  box-sizing: inherit;\n}\n\n:-moz-focusring {\n  outline: auto;\n}\n\n:focus {\n  outline: #daeaf7 solid 2px;\n  z-index: 1;\n}\n\nhtml,\nbody {\n  width: 100%;\n  padding: 0;\n  margin: 0;\n  color: var(--color-grey5);\n  background-color: var(--color-grey1);\n}\n\n[data-light] {\n  --color-invalid: var(--color-invalid);\n  color: var(--color-grey6);\n  background-color: var(--color-grey2);\n}\n\nbody {\n  font-family: var(--font-body);\n  display: flex;\n  flex-direction: column;\n  min-height: 100%;\n}\n\nhr {\n  display: block;\n  height: 1px;\n  border: 0;\n  background-color: var(--color-galaxy);\n  margin-top: 2rem;\n  margin-bottom: 2rem;\n}\n\n.container {\n  width: 100%;\n  padding: 56px 5% 24px;\n  flex: 1 1;\n  min-height: calc(100vh - 112px);\n  background-color: var(--color-offwhite);\n}',""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/inputs.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".input-label {\n  display: inline-flex;\n  align-items: center;\n  justify-content: flex-start;\n  font-size: .75rem;\n  font-weight: 500;\n  width: 100%;\n  color: var(--color-grey4);\n  margin-top: 4px;\n}\n\n.tooltip-content {\n  color: var(--color-grey5);\n  border-radius: 4px;\n  padding: 6px 10px;\n  background-color: var(--color-grey1);\n  font-size: 0.85rem;\n  font-weight: 500;\n  border: 1px solid var(--color-warmblue);\n  box-shadow: hsl(206 22% 7% / 35%) 0px 10px 38px -10px, hsl(206 22% 7% / 20%) 0px 10px 20px -15px;\n}",""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/list.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,"ul {\n  list-style-type: none;\n  padding: 4px 0px;\n  margin: 0px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: var(--color-warning);\n}",""]),module.exports=exports},"./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/menu.css":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".menu {\n  padding: 12px 8px;\n  border: 1px solid var(--color-grey3);\n  border-radius: var(--border-radius-02);\n  background-color: var(--color-grey1);\n  row-gap: 6px;\n}\n\n.menu-button {\n  border: none;\n  background-color: rgba(0, 0, 0, 0);\n  color: var(--color-grey6);\n  font-size: 1rem;\n  font-weight: 500;\n}\n\n.menu-item {\n  width: 100%;\n  padding: 2px 8px;\n  border-radius: var(--border-radius-01);\n  transition: background-color 250ms ease-out;\n  text-align: right;\n}\n\n.menu-item:hover {\n  background-color: var(--color-warmblue0);\n  cursor: pointer;\n}\n\n.menu-item:focus {\n  outline-width: 1px;\n  outline-color: var(--color-warmblue);\n}\n\n.menu-item-active {\n  background-color: var(--color-warmblue0);\n}\n\n.menu-item-danger {\n  color: var(--color-invalid);\n}\n\n.menu-item-danger:hover {\n  background-color: var(--color-invalid0);\n}\n\n.menu-item-danger:focus {\n  outline-width: 1px;\n  outline-color: var(--color-invalid);\n}\n\n.dropdown-arrow {\n  fill: var(--color-grey1);\n  stroke: var(--color-grey3);\n  stroke-width: 1px;\n}",""]),module.exports=exports},"./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.tsx)$":function(module,exports,__webpack_require__){var map={"./DrawingPanel/DrawingPanel.stories.tsx":"./src/DrawingPanel/DrawingPanel.stories.tsx"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./src sync recursive ^\\.(?:(?:^|\\/|(?:(?:(?!(?:^|\\/)\\.).)*?)\\/)(?!\\.)(?=.)[^/]*?\\.stories\\.tsx)$"},"./src/DrawingPanel/DrawingPanel.stories.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Default",(function(){return Default}));__webpack_require__("./node_modules/core-js/modules/es.function.bind.js");var react=__webpack_require__("./node_modules/react/index.js"),react_default=__webpack_require__.n(react),objectSpread2=(__webpack_require__("./node_modules/core-js/modules/es.array.concat.js"),__webpack_require__("./node_modules/core-js/modules/es.number.to-fixed.js"),__webpack_require__("./node_modules/core-js/modules/es.array.find.js"),__webpack_require__("./node_modules/core-js/modules/es.array.fill.js"),__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js")),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),index_module=__webpack_require__("./node_modules/@radix-ui/react-progress/dist/index.module.js"),ui="ui";function historyPush(pastScene){return{type:"history",subtype:"HISTORY_PUSH",pastScene:pastScene}}function uiTargetHome(toggle){return{type:ui,subtype:"UI_TARGETHOME",toggle:toggle}}function uiDragStart(toggle,pt){return{type:ui,subtype:"UI_DRAGSTART",toggle:toggle,pt:pt}}function uiDragging(toggle){return{type:ui,subtype:"UI_DRAGGING",toggle:toggle}}function uiMode(mode){return{type:ui,subtype:"UI_MODE",mode:mode}}function uiBoxSelect(vec2,_int){return{type:ui,subtype:"UI_BOXSELECT",vec2:vec2,int:_int}}function uiSnapGrid(){return{type:ui,subtype:"UI_SNAPGRID"}}function uiSnapPt(){return{type:ui,subtype:"UI_SNAPPT"}}function uiSnapGlobal(){return{type:ui,subtype:"UI_SNAPGLOBAL"}}function uiSnapRef(){return{type:ui,subtype:"UI_SNAPREF"}}function editStroke(hex,id){return{type:"scene",subtype:"EDIT_STROKE",hex:hex,id:id}}function editSelectApnd(sel){return{type:"scene",subtype:"EDIT_SELECTAPND",sel:sel}}function editSelectRmv(sel){return{type:"scene",subtype:"EDIT_SELECTRMV",sel:sel}}function editTranslate(id,v3){return{type:"scene",subtype:"EDIT_TRANSLATE",id:id,v3:v3}}function scenePushEditItem(prim,edit){return{type:"scene",subtype:"SCENE_PUSHEDITITEM",prim:prim,edit:edit}}function sceneRmvItem(id){return{type:"scene",subtype:"SCENE_RMVITEM",id:id}}function sceneEscItem(id,newEditItem){return{type:"scene",subtype:"SCENE_ESCITEM",id:id,newEditItem:newEditItem}}__webpack_require__("./node_modules/core-js/modules/es.object.assign.js"),__webpack_require__("./node_modules/core-js/modules/es.array.map.js"),__webpack_require__("./node_modules/core-js/modules/es.array.slice.js"),__webpack_require__("./node_modules/core-js/modules/es.array.filter.js"),__webpack_require__("./node_modules/core-js/modules/es.array.includes.js"),__webpack_require__("./node_modules/core-js/modules/es.string.includes.js"),__webpack_require__("./node_modules/core-js/modules/es.array.index-of.js"),__webpack_require__("./node_modules/core-js/modules/es.object.keys.js"),__webpack_require__("./node_modules/core-js/modules/es.array.splice.js"),__webpack_require__("./node_modules/core-js/modules/es.array.is-array.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.description.js"),__webpack_require__("./node_modules/core-js/modules/es.object.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.string.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.iterator.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.from.js"),__webpack_require__("./node_modules/core-js/modules/es.function.name.js"),__webpack_require__("./node_modules/core-js/modules/es.date.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.string.replace.js"),__webpack_require__("./node_modules/core-js/modules/es.regexp.exec.js"),__webpack_require__("./node_modules/core-js/modules/es.regexp.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.array.sort.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.uint16-array.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.copy-within.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.every.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.fill.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.filter.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.find.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.find-index.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.for-each.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.includes.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.index-of.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.join.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.last-index-of.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.map.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.reduce.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.reduce-right.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.reverse.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.set.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.slice.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.some.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.sort.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.subarray.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.to-locale-string.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.array-buffer.slice.js"),__webpack_require__("./node_modules/core-js/modules/es.array-buffer.constructor.js"),__webpack_require__("./node_modules/core-js/modules/es.data-view.js"),__webpack_require__("./node_modules/core-js/modules/es.array.for-each.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.for-each.js"),__webpack_require__("./node_modules/core-js/modules/es.object.define-property.js"),__webpack_require__("./node_modules/core-js/modules/es.array.reduce.js"),__webpack_require__("./node_modules/core-js/modules/es.array.find-index.js"),__webpack_require__("./node_modules/core-js/modules/es.string.search.js"),__webpack_require__("./node_modules/core-js/modules/web.url.js"),__webpack_require__("./node_modules/core-js/modules/es.typed-array.uint8-array.js");var chroma=__webpack_require__("./node_modules/chroma-js/chroma.js"),chroma_default=__webpack_require__.n(chroma),twgl_full_module=__webpack_require__("./node_modules/twgl.js/dist/4.x/twgl-full.module.js"),redux=__webpack_require__("./node_modules/redux/es/redux.js"),rbush_min=__webpack_require__("./node_modules/rbush/rbush.min.js"),rbush_min_default=__webpack_require__.n(rbush_min),rbush_knn_min=__webpack_require__("./node_modules/rbush-knn/rbush-knn.min.js"),rbush_knn_min_default=__webpack_require__.n(rbush_knn_min),deviceToSceneScalar=function deviceToSceneScalar(size,zoom,scale,resolution){return size*(zoom/(resolution.y*scale))},dispToValue=function dispToValue(value,scale,zoom){return value*scale/zoom*-1};function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e3){didErr=!0,err=_e3},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}var gesture_DrawUI=function(){function DrawUI(){_classCallCheck(this,DrawUI);var targetHome=new UIModifier("Return Home","view","h",{clck:function clck(){return dispatch(uiTargetHome(!0))}}),screenshot=new UIModifier("Screenshot","export","l",{clck:screenshotDirect}),snapPt=new UIModifier("Snap Point","snap","p",{clck:function clck(){return dispatch(uiSnapPt())}}),snapRef=new UIModifier("Snap Ref","snap","s",{clck:function clck(){return dispatch(uiSnapRef())}}),snapGlobal=new UIModifier("Snap Global","snap","Shift",{clck:function clck(){return dispatch(uiSnapGlobal())}}),snapGrid=new UIModifier("Snap Grid","snap","g",{clck:function clck(){return dispatch(uiSnapGrid())}}),endDraw=new UIModifier("End Draw","edit","Enter",{clck:endDrawClck}),escDraw=new UIModifier("Esc Draw","edit","Escape",{clck:escDrawClck}),selMods=[targetHome,screenshot,new UIModifier("End Sel","select","Escape",{clck:endSelClck})],draw=new UIMode("draw",[targetHome,screenshot,snapGlobal,snapRef,snapGrid,snapPt,endDraw,escDraw],{mv:drawMv,up:drawUp}),select=new UIMode("select",selMods,{mv:selMv,up:selUp,dwn:selDwn});return this.modes=[draw,select],document.querySelector("#canvas-container").addEventListener("mouseup",this.mouseUp.bind(this)),document.querySelector("#canvas-container").addEventListener("mousedown",this.mouseDown.bind(this)),document.querySelector("#canvas-container").addEventListener("mousemove",this.mouseMove.bind(this)),this.cntlPressed=!1,this.zPressed=!1,this.yPressed=!1,this.shiftPressed=!1,window.addEventListener("keyup",this.keyUp.bind(this)),window.addEventListener("keydown",this.keyDown.bind(this)),this}return _createClass(DrawUI,[{key:"update",value:function update(){var mode=this.modes.find((function(a){return a.name==draw_state.ui.mode}));if(mode){if(draw_state.ui.targeting)if(twgl_full_module.q.distanceSq(draw_state.ui.target,draw_dPt)>1e-5){var xyDpt=twgl_full_module.q.create(draw_dPt[0],draw_dPt[1],0),xyTarget=twgl_full_module.q.create(draw_state.ui.target[0],draw_state.ui.target[1],0);twgl_full_module.q.distanceSq(xyTarget,xyDpt)>1e-5?(twgl_full_module.q.lerp(xyDpt,xyTarget,.1,xyDpt),draw_dPt[0]=xyDpt[0],draw_dPt[1]=xyDpt[1]):twgl_full_module.q.lerp(draw_dPt,draw_state.ui.target,.1,draw_dPt),draw_view.minX=(0-draw_dPt[0])/(32/draw_dPt[2]),draw_view.minY=(0-draw_dPt[1])/(32/draw_dPt[2]),draw_view.maxX=(draw_resolution.x/draw_resolution.y-draw_dPt[0])/(32/draw_dPt[2]),draw_view.maxY=(1-draw_dPt[1])/(32/draw_dPt[2])}else dispatch(uiTargetHome(!1));if("select"===draw_state.ui.mode&&draw_state.ui.dragging){var _step,_iterator=_createForOfIteratorHelper(draw_state.scene.selected);try{for(_iterator.s();!(_step=_iterator.n()).done;){var id=_step.value;if(id!==draw_state.scene.editItem){var mouse=twgl_full_module.q.copy(draw_mPt),translate=twgl_full_module.q.subtract(mouse,draw_state.ui.dragOrigin);dispatch(editTranslate(id,translate))}}}catch(err){_iterator.e(err)}finally{_iterator.f()}dispatch(uiDragStart(!0,twgl_full_module.q.copy(draw_mPt)))}var _step2,_iterator2=_createForOfIteratorHelper(mode.modifiers);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var m=_step2.value;m.update&&m.update()}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}},{key:"mouseUp",value:function mouseUp(e){var mode=this.modes.find((function(a){return a.name==draw_state.ui.mode}));mode.up&&mode.up(e)}},{key:"mouseDown",value:function mouseDown(e){var mode=this.modes.find((function(a){return a.name==draw_state.ui.mode}));mode.dwn&&mode.dwn(e)}},{key:"mouseMove",value:function mouseMove(e){var rect=gl.canvas.getBoundingClientRect(),scene=function deviceToScene(pt,dPt,scale,resolution,dst){var f=dPt[2]/scale,t=1/resolution.y,scene=twgl_full_module.q.mulScalar(pt,t,null!=dst?dst:twgl_full_module.q.create());return twgl_full_module.q.subtract(scene,dPt,scene),twgl_full_module.q.mulScalar(scene,f,scene),scene}(twgl_full_module.q.create(e.clientX-rect.left,e.clientY-rect.top,0),draw_dPt,32,draw_resolution),editItem=draw_state.scene.editItems.find((function(item){return item.id===draw_state.scene.editItem})),pos=function calcMousePosition(evPt,editItem,state,snaps){var pt={x:evPt.x,y:evPt.y},editPts=editItem?editItem.pts:[];snaps.snapRef&&editPts.length>1&&(pt=gesture_snapToRelativeAngle({x:evPt.x,y:evPt.y},editPts.slice(editPts.length-2),snaps.snapRefAngle));snaps.snapGlobal&&editPts.length>0&&(pt=gesture_snapToGlobalAngle({x:evPt.x,y:evPt.y},editPts[editPts.length-1],snaps.snapGlobalAngle));snaps.snapGrid&&(pt=snapToGrid({x:evPt.x,y:evPt.y},state.grid));if(snaps.snapPt){var snapPt=gesture_snapToPt({x:evPt.x,y:evPt.y});snapPt&&(pt=snapPt)}return pt}({x:scene[0],y:scene[1]},editItem,draw_state.cursor,draw_state.ui);draw_mPt[0]=pos.x,draw_mPt[1]=pos.y;var mode=this.modes.find((function(a){return a.name==draw_state.ui.mode}));mode.up&&mode.mv(e)}},{key:"keyUp",value:function keyUp(e){if("BODY"===document.activeElement.tagName){var key=e.key,mode=this.modes.find((function(a){return a.name==draw_state.ui.mode}));"Shift"===key&&(this.shiftPressed=!1),"Meta"===key&&(this.cntlPressed=!1),"Control"===key&&(this.cntlPressed=!1),"Backspace"===key&&draw_state.scene.selected.length>0&&dispatch(sceneRmvItem(draw_state.scene.selected));var _step3,_iterator3=_createForOfIteratorHelper(mode.modifiers);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var m=_step3.value;m.keyCut==key&&m.clck()}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}},{key:"keyDown",value:function keyDown(e){if("BODY"===document.activeElement.tagName){var key=e.key;"Meta"==key&&(this.cntlPressed=!0),"Shift"==key&&(this.shiftPressed=!0),"Control"==key&&(this.cntlPressed=!0),("z"===key||"Z"===key)&&this.shiftPressed&&this.cntlPressed?dispatch({type:"history",subtype:"HISTORY_REDO"}):"z"!==key&&"Z"!==key||!this.cntlPressed||dispatch({type:"history",subtype:"HISTORY_UNDO"})}}}]),DrawUI}();function drawMv(e){var _step4,_iterator4=_createForOfIteratorHelper(this.modifiers);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var m=_step4.value;m.mv&&m.mv(e,this.options)}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}function drawUp(e){var _mPt$,_step5,_iterator5=_createForOfIteratorHelper(this.modifiers);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var m=_step5.value;if(m.up)m.up(e)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}var pt=new primitives_vec(draw_mPt[0],draw_mPt[1],null!==(_mPt$=draw_mPt[2])&&void 0!==_mPt$?_mPt$:0,0,draw_state.scene.editItem);dispatch(function sceneAddPt(pts,id){return{type:"scene",subtype:"SCENE_ADDPT",pts:pts,id:id}}([pt],draw_state.scene.editItem)),dispatch(historyPush(draw_state.scene));var currItem=draw_state.scene.editItems.find((function(item){return item.id===draw_state.scene.editItem}));if(("circle"==currItem.type||"ellipse"==currItem.type||"rectangle"==currItem.type)&&2==currItem.pts.length){var newPrim=new primitives_prim(currItem.type,[],Object.assign({},currItem.properties));dispatch(scenePushEditItem(newPrim)),dispatch(editSelectRmv(currItem.id)),dispatch(historyPush(draw_state.scene))}}function endSelClck(){dispatch(uiMode("draw")),dispatch({type:"scene",subtype:"EDIT_SELECTCLR"})}function selUp(e){draw_state.ui.dragging?(dispatch(uiDragStart(!1,draw_mPt)),dispatch(uiDragging(!1)),draw_state.scene.selected.includes(draw_state.scene.hover)&&dispatch(editSelectRmv(draw_state.scene.hover))):draw_state.ui.dragStart&&dispatch(uiDragStart(!1,draw_mPt)),dispatch(uiBoxSelect(draw_mPt,0))}function selDwn(e){""!==draw_state.scene.hover?(dispatch(uiDragStart(!0,draw_mPt)),dispatch(editSelectApnd([draw_state.scene.hover]))):dispatch(uiBoxSelect(draw_mPt,1))}function selMv(){if(draw_state.ui.dragStart&&!draw_state.ui.dragging&&(dispatch(uiDragging(!0)),dispatch(historyPush(draw_state.scene))),draw_state.ui.boxSelectState){var selBox={minX:Math.min(draw_state.ui.boxSel[0],draw_mPt[0]),maxX:Math.max(draw_state.ui.boxSel[0],draw_mPt[0]),minY:Math.min(draw_state.ui.boxSel[1],draw_mPt[1]),maxY:Math.max(draw_state.ui.boxSel[1],draw_mPt[1])},boxSel=ptTree.search(selBox).reduce((function(prev,curr,index,array){return prev.includes(curr.pId)?prev:[].concat(_toConsumableArray(prev),[curr.pId])}),[]);dispatch(function editSelectReplace(sel){return{type:"scene",subtype:"EDIT_SELECTREPLACE",sel:sel}}(boxSel))}}var gesture_snapToPt=function snapToPt(pt){var ptNear=rbush_knn_min_default()(ptTree,pt.x,pt.y,1,void 0,.01);return ptNear.length>0&&ptNear[0]},snapToGrid=function snapToGrid(pt,_ref){var gridX=_ref.x,gridY=_ref.y;return pt.x=Math.round(pt.x/gridX)*gridX+1e-18,pt.y=Math.round(pt.y/gridY)*gridY+1e-18,pt},gesture_snapToGlobalAngle=function snapToGlobalAngle(pt,prev,globalAngle){var line=cloneVec(prev);line.x=line.x-pt.x,line.y=line.y-pt.y;var angle=angleVec(line)*(180/Math.PI),snapA=Math.round(angle/globalAngle)*globalAngle;snapA*=Math.PI/180;var length=lengthVec(line);return pt.x=prev.x-length*Math.cos(snapA),pt.y=prev.y-length*Math.sin(snapA),pt},gesture_snapToRelativeAngle=function snapToRelativeAngle(pt,_ref2,relativeAngle){var _ref3=_slicedToArray(_ref2,2),prevPrev=_ref3[0],prev=_ref3[1],line=cloneVec(prev),linePrev=cloneVec(prevPrev);line.x=line.x-pt.x,line.y=line.y-pt.y;var lineN=normVec(line);linePrev.x=prev.x-linePrev.x,linePrev.y=prev.y-linePrev.y;var linePrevN=normVec(linePrev),dot=function dotVec(a,b){var x=a.x*b.x,y=a.y*b.y;return x+y}(lineN,linePrevN),det=linePrevN.x*lineN.y-linePrevN.y*lineN.x,angle=Math.atan2(det,dot)*(180/Math.PI),snapA=Math.round(angle/relativeAngle)*relativeAngle;return snapA=snapA*(Math.PI/180)+angleVec(linePrev),pt.x=prev.x-lengthVec(line)*Math.cos(snapA),pt.y=prev.y-lengthVec(line)*Math.sin(snapA),pt};function endDrawClck(){var currItem=draw_state.scene.editItems.find((function(item){return item.id===draw_state.scene.editItem}));if(currItem.pts.length<1)dispatch(uiMode("select"));else{var newPrim=new primitives_prim(currItem.type,[],Object.assign({},currItem.properties));dispatch(editSelectRmv(currItem.id)),dispatch(scenePushEditItem(newPrim)),dispatch(historyPush(draw_state.scene))}}function escDrawClck(){var id=draw_state.scene.editItem,currItem=draw_state.scene.editItems.find((function(i){return i.id===id})),props=Object.assign({},currItem.properties),newPrim=new primitives_prim(currItem.type,[],props);dispatch(sceneEscItem(id,newPrim)),dispatch(historyPush(draw_state.scene))}var UIMode=_createClass((function UIMode(name,modifiers,_events,_options){_classCallCheck(this,UIMode),this.name=name,this.modifiers=modifiers,_events.mv&&(this.mv=_events.mv),_events.up&&(this.up=_events.up),_events.dwn&&(this.dwn=_events.dwn),_events.scrll&&(this.scrll=_events.scrll),this.options=_options||{factor:1}})),UIModifier=_createClass((function UIModifier(name,tag,keyCut,events,_pulse){_classCallCheck(this,UIModifier),this.name=name,this.tag=tag,this.keyCut=keyCut,events.update&&(this.update=events.update),events.clck&&(this.clck=events.clck.bind(this)),events.mv&&(this.mv=events.mv.bind(this)),events.up&&(this.up=events.up.bind(this)),events.dwn&&(this.dwn=events.dwn.bind(this)),events.scrll&&(this.scrll=events.scrll.bind(this)),this.pulse="boolean"==typeof _pulse&&_pulse})),sdCircle="\nfloat sdCircle(vec2 uv, vec2 p, float r){\n  uv = uv - p;\n  return length(uv) - r;\n}\n",sdBox="\n//uv, p translation point, b 1/2 length, width, r radius\nfloat sdBox( in vec2 uv, in vec2 p, in vec2 b , in float r)\n{\n    b -= r;\n    uv = (uv-p);\n    vec2 d = abs(uv)-b;\n    return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0) - r;\n}\n",sdLine="\nfloat sdLine( vec2 p, vec2 a, vec2 b, float th, float dashOn )\n{\n    vec2 ba = b-a;\n    vec2 pa = p-a;\n    float h =clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length(pa-h*ba) - th;\n}\n",sdEllipse="\n// https://www.shadertoy.com/view/tt3yz7\nfloat sdEllipse( vec2 p, vec2 e )\n{\n    vec2 pAbs = abs(p);\n    vec2 ei = 1.0 / e;\n    vec2 e2 = e*e;\n    vec2 ve = ei * vec2(e2.x - e2.y, e2.y - e2.x);\n    \n    vec2 t = vec2(0.70710678118654752, 0.70710678118654752);\n    for (int i = 0; i < 3; i++) {\n        vec2 v = ve*t*t*t;\n        vec2 u = normalize(pAbs - v) * length(t * e - v);\n        vec2 w = ei * (v + u);\n        t = normalize(clamp(w, 0.0, 1.0));\n    }\n    \n    vec2 nearestAbs = t * e;\n    float dist = length(pAbs - nearestAbs);\n    return dot(pAbs, pAbs) < dot(nearestAbs, nearestAbs) ? -dist : dist;\n}\n",filterLine="\nfloat line(float d, float w){\n  d = clamp(abs(d) - w, 0.0, 1.0);\n  d = 1.0 - smoothstep(0.0, 0.003, abs(d));\n  return d;\n}\n",filterFill="\n// fill\nfloat fillMask(float dist){\n\treturn smoothstep(0.0,0.003, clamp(-dist, 0.0, 1.0));\n}\n",drawPt="\nvec3 drawPt(vec2 uv, vec2 p, float dist, vec3 col){\n  vec3 color = mix(col, vec3(1.0, 0.25, 0.25), dist);\n  return color;\n}\n",transformUV="\n  uv.x *= u_resolution.x / u_resolution.y;\n  uv -= u_dPt.xy;\n  uv *= u_dPt.z / 32.;\n",circleEdit="#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\nuniform vec3 u_mPt;\n\nuniform sampler2D u_eTex;\n\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\n\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdCircle+"\n"+filterLine+"\n"+filterFill+"\n\nvoid main(){\n  outColor = vec4(1.0);\n  vec2 uv = v_texcoord;\n  "+transformUV+"\n\n  float texelOffset = 0.5 * (1. / (16. * 16.));\n\n  float dist = sdCircle(uv, u_mPt.xy, 0.125);\n  \n  vec2 center = texture(u_eTex, vec2(texelOffset, texelOffset)).xy;\n\n  if(center.x != 0.0){\n    vec2 rPt = u_mPt.xy;\n    float radius = distance(center, rPt);\n    dist = sdCircle(uv, center, radius);\n  }\n\n  //stroke\n  float stroke = line(dist, u_weight);\n  vec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n  float fill = fillMask(dist);\n  vec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n\n  dist = min(stroke, fill);\n\n  if ( stroke + fill < 0.01) discard;\n\n  outColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n  outColorDist = vec4(vec3(dist),1.0);\n}",circleStub="#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_scale;\n\nuniform sampler2D u_eTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\n\nuniform vec3 u_idCol;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdCircle+"\n"+filterLine+"\n"+filterFill+"\n"+drawPt+"\n\nvoid main(){\n  outColor = vec4(u_idCol, 0.125);\n  vec2 uv = v_texcoord;\n  float d = 0.0;\n\n  //$INSERT CALL$------\n\n  //$ENDINSERT CALL$---\n  outColorDist = vec4(vec3(d), 1.0);\n}",ellipseEdit="#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_mPt;\n\nuniform sampler2D u_eTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\nfloat msign(in float x) { return (x<0.0)?-1.0:1.0; }\n\n"+sdCircle+"\n"+sdEllipse+"\n"+filterLine+"\n"+filterFill+"\n\nvoid main(){\n  outColor = vec4(1.0);\n  vec2 uv = v_texcoord;\n  "+transformUV+"\n\n  float texelOffset = 0.5 * (1. / (16. * 16.));\n\n  float dist = sdEllipse(uv - u_mPt.xy, vec2(0.125, 0.0625));\n  \n  vec2 center = texture(u_eTex, vec2(texelOffset, texelOffset)).xy;\n\n  if(center.x != 0.0){\n    // vec2 rPt = u_mPt.xy;\n    // float radius = distance(center, rPt);\n    dist = sdEllipse(uv - center, max(abs(u_mPt.xy - center), vec2(0.01,0.01)));\n  }\n\n  //stroke\n  float stroke = line(dist, u_weight);\n  vec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n  float fill = fillMask(dist);\n  vec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n\n  dist = min(stroke, fill);\n\n  if ( fill + stroke < 0.01) discard;\n\n  outColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n  outColorDist = vec4(vec3(dist),1.0);\n}",ellipseStub="#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_scale;\n\nuniform sampler2D u_eTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\n\nuniform vec3 u_idCol;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\nfloat msign(in float x) { return (x<0.0)?-1.0:1.0; }\n\n"+sdCircle+"\n"+sdEllipse+"\n"+filterLine+"\n"+filterFill+"\n\nvoid main(){\n  outColor = vec4(u_idCol, 0.125);\n  vec2 uv = v_texcoord;\n  \n  float d = 0.0;\n\n  //$INSERT CALL$------\n\n  //$ENDINSERT CALL$---  \n  outColorDist = vec4(vec3(d),1.0);\n}",pointLightEdit="#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\n\nuniform vec3 u_mPt;\nuniform vec3 u_dPt;\n\nuniform vec3 u_scale;\n\n// might be worth it to pack multiple lights into the same shader\nuniform sampler2D u_eTex;\nuniform sampler2D u_distTex;\n\nuniform float u_cTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\nuniform float u_radius;\n\n// uniform vec3 u_idCol;\n\nout vec4 outColor;\n\n"+sdCircle+"\n"+filterFill+"\n"+drawPt+"\n\nfloat sceneDist(vec2 uv) {\n// reverse transformation of uv\n\t\n  uv *= 32. / u_dPt.z;\n  uv += u_dPt.xy;\n  uv.x *= u_resolution.y / u_resolution.x;\n\n\n\t// flip y\n\tuv.y = 1.0 - uv.y;\n  \n  float d = 0.0 - texture(u_distTex, uv).x;\n  return d;\n}\n\nfloat shadow(vec2 p, vec2 pos, float radius)\n{\n\tvec2 dir = normalize(pos - p);\n\tfloat dl = length(p - pos);\n\t// fraction of light visible, starts at one radius (second half added in the end);\n\tfloat lf = radius * dl;\n\t// distance traveled\n\tfloat dt = 0.000001;\n\tfor (int i = 0; i < 1000; ++i)\n\t{\n\t\t// distance to scene at current position\n\t\tfloat sd = sceneDist(p + dir * dt);\n\n    if (sd < 0.){\n      return 0.0;\n    }\n\t\t// width of cone-overlap at light\n\t\t// 0 in center, so 50% overlap: add one radius outside of loop to get total coverage\n\t\t// should be '(sd / dt) * dl', but '*dl' outside of loop\n\t\tlf = min(lf, sd / dt);\n\t\t// move ahead\n\t\t// dt += max(0.000001, abs(sd));\n    dt += clamp(abs(sd), 0.0000001, 0.001);\n    // dt += 0.00001;\n\t\tif (dt > dl) break;\n\t}\n\t// multiply by dl to get the real projected overlap (moved out of loop)\n\t// add one radius, before between -radius and + radius\n\t// normalize to 1 ( / 2*radius)\n\tlf = clamp((lf * dl + radius) / (2.0 * radius), 0.0, 1.0);\n\tlf = smoothstep(0.00, 1.0, lf);\n\treturn lf;\n}\n\nvec4 drawLight(vec2 p, vec2 pos, vec3 color, float range, float radius)\n{\n\t// distance to light\n\tfloat ld = length(p - pos);\n\t// out of range\n\tif (ld > range) return vec4(0.0);\n\t// shadow and falloff\n\tfloat shad = shadow(p, pos, range);\n\tfloat fall = (range - ld)/range;\n\tfall *= fall;\n\tfloat source = fillMask(sdCircle(p - pos, vec2(0.,0.), radius));\n  return vec4((shad * fall + source) * color, shad * fall);\n}\n\nfloat luminance(vec3 col)\n{\n\treturn 0.2126 * col.r + 0.7152 * col.g + 0.0722 * col.b;\n}\n\nvec3 setLuminance(vec3 col, float lum)\n{\n\tlum /= luminance(col);\n\treturn col *= lum;\n}\n\nvoid main(){\n  outColor = vec4(0.0);\n  vec2 uv = v_texcoord;\n  "+transformUV+"\n\n\tvec2 q = v_texcoord;\n\n  //--- if we want to draw multiple point lights from the same texture?\n  //--- could be a cool optimization for many lights\n  //--- would need a texture(s) for color / radius\n  // float texelOffset = 0.5 * (1. / (16. * 16.));\n\n  //fill color\n  //set luminance\n  // vec4 col = vec4(1.0);\n\n  // for (float i = 0.; i < 16.; i++ ){\n  //   float yIndex = i / 16. + texelOffset;\n\n  //   for (float j = 0.; j < 16.; j++ ){\n  //     float xIndex = j / 16.  + texelOffset;\n  //     vec2 vIndex = vec2(xIndex, yIndex);\n  //     vec2 tPt = texture(u_eTex, vIndex).xy;\n\n  //     if (tPt == vec2(0.)){ break; }\n\n  //     // dist = min(dist, sdLine(uv, prevPt, tPt, u_weight, 0.0));\n  //     // dSh = min(dSh, sdLine(uv - dShTrans, prevPt, tPt, u_weight, 0.0));\n  //     col *= drawLight(uv, tPt, setLuminance(u_fill, 0.9), u_weight * 100., u_weight);\n  //   }\n  // }\n  // ----\n \n  //fill color\n  //set luminance\n  vec4 col = drawLight(uv, u_mPt.xy, setLuminance(u_fill, 0.9), u_weight * 100., u_weight);\n\n\t//vignette\n  float vignette = clamp(pow( 256.0*q.x*q.y*(1.0-q.x)*(1.0-q.y), .125 ),0.,1.)*.5;\n\n  outColor = col + vec4(vec3(vignette), abs(vignette - 1.0));\n}\n",polygonEdit="\n#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_mPt;\n\nuniform sampler2D u_eTex;\nuniform float u_cTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdLine+"\n"+sdCircle+"\n"+filterLine+"\n"+filterFill+"\n\nvoid main(){\n  outColor = vec4(1.0);\n  vec2 uv = v_texcoord;\n  "+transformUV+"\n\n  float texelOffset = 0.5 * (1. / (16. * 16.));\n\n  float dist = sdCircle(uv, u_mPt.xy, 0.003);\n\n  vec2 first = texture(u_eTex, vec2(0./16. + texelOffset, 0./16. + texelOffset)).xy;\n\n  float iX = (mod(u_cTex, 16.) / 16.) + texelOffset;\n  float iY = (floor(u_cTex / 16.) / 16.) + texelOffset;\n\n  vec2 last = texture(u_eTex, vec2(iX, iY)).xy;\n  dist = dot(uv - first, uv - first);\n  vec2 prevPt = last;\n\n  //drop shadow\n  vec2 dShTrans = normalize(vec2(-0.125, 0.125))*.01;\n  float dSh = 10.0;\n\n  float s = 1.0;\n  for (float i = 0.; i < 16.; i++ ){\n    float yIndex = i / 16. + texelOffset;\n    for (float j = 0.; j < 16.; j++ ){\n      float xIndex = j / 16.  + texelOffset;\n      vec2 vIndex = vec2(xIndex, yIndex);\n\n      vec2 tPt = texture(u_eTex, vIndex).xy;\n\n      if (tPt == vec2(0.)){ break; }\n\n      // https://www.shadertoy.com/view/wdBXRW iq signed distance to polygon\n      if (prevPt != vec2(0.)){\n        vec2 e = prevPt - tPt;\n        vec2 w = uv - tPt;\n        vec2 b = w - e*clamp( dot(w,e)/dot(e,e), 0.0, 1.0 );\n        dist = min( dist, dot(b,b) );\n\n        // vec2 wDSh = (uv - dShTrans) - tPt;\n        // vec2 bDSh = wDSh - e*clamp( dot(wDSh,e)/dot(e,e), 0.0, 1.0 );\n        // dSh = min(dSh, dot(bDSh, bDSh));\n\n        // winding number from http://geomalgorithms.com/a03-_inclusion.html\n        bvec3 cond = bvec3( uv.y>=tPt.y, uv.y<prevPt.y, e.x*w.y>e.y*w.x );\n        if( all(cond) || all(not(cond)) ) s*=-1.0;\n\n        prevPt = tPt;\n      }\n    }\n  }\n\n  dist = s*sqrt(dist);\n\n\n  float fill = fillMask(dist);\n  vec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n\n  if (prevPt != vec2(0.)){\n    dist = min(dist, sdLine(uv, prevPt, u_mPt.xy, u_weight / 2., 0.0));\n    dist = min(dist, sdLine(uv, u_mPt.xy, first, u_weight / 2., 0.0));\n\n    // dSh = min(dSh, sdLine(uv - dShTrans, prevPt, u_mPt.xy, u_weight / 2.0, 0.0));\n    // dSh = min(dSh, sdLine(uv - dShTrans, u_mPt.xy, first, u_weight / 2.0, 0.0));\n  }\n\n  float stroke = line(dist, u_weight);\n  vec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n  \n  // dSh = (1. - smoothstep(0., 0.15, sqrt(dSh)))*.25;\n\n  dist = min(stroke, fill);\n  \n  if ( stroke + fill < 0.01) discard;\n\n  outColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n  outColorDist = vec4(vec3(dist),1.0);\n}",polygonStub="\n#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_scale;\n\nuniform sampler2D u_eTex;\nuniform float u_cTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\n\nuniform vec3 u_idCol;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdLine+"\n"+sdCircle+"\n"+filterLine+"\n"+filterFill+"\n\n//$INSERT FUNCTION$------\n\n//$ENDINSERT FUNCTION$---\n\nvec4 sceneDist(vec2 uv) {\n  //temp distance\n  float d = 1.0;\n  //xyz:color, w:cumulative distance \n  vec4 colDist = vec4(1.);\n  //index in parameters texture\n  vec2 index = vec2(0.);\n  //$INSERT CALL$------\n\n  //$ENDINSERT CALL$---\n  return colDist;\n}\n\nvoid main(){\n  outColor = vec4(u_idCol, 1.0);\n  vec2 uv = v_texcoord;\n\n  vec4 scene = sceneDist(uv);\n  float d = scene.w;\n\n  float fill = fillMask(d);\n  vec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n  float stroke = line(d, u_weight);\n  vec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n  \n  float dist = min(stroke, fill);\n\n  if ( stroke + fill < 0.01) discard;\n\n  outColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n  outColorDist = vec4(vec3(dist),1.0);\n}",pLineEdit="\n#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_mPt;\n\nuniform sampler2D u_eTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform float u_opacity;\n\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdLine+"\n"+sdCircle+"\n"+filterLine+"\n"+drawPt+"\n\nvoid main(){\n  outColor = vec4(1.0);\n  vec2 uv = v_texcoord;\n  "+transformUV+"\n\n  float texelOffset = 0.5 * (1. / (16. * 16.));\n\n  float dist = 10.0;\n\n  vec2 prevPt = texture(u_eTex, vec2(texelOffset, texelOffset)).xy;\n  float one = 1.0;\n\n  if(prevPt == vec2(0.)) {discard;}\n\n  //drop shadow\n  vec2 dShTrans = normalize(vec2(-1. * u_weight, u_weight))*u_weight;\n  float dSh = 10.0;\n\n  for (float i = 0.; i < 16.; i++ ){\n    float yIndex = i / 16. + texelOffset;\n\n    for (float j = 0.; j < 16.; j++ ){\n      //this is to skip the first point only;\n      j += one;\n      one = 0.;\n\n      float xIndex = j / 16.  + texelOffset;\n      vec2 vIndex = vec2(xIndex, yIndex);\n      vec2 tPt = texture(u_eTex, vIndex).xy;\n\n      if (tPt == vec2(0.)){ break; }\n\n      dist = min(dist, sdLine(uv, prevPt, tPt, u_weight, 0.0));\n      dSh = min(dSh, sdLine(uv - dShTrans, prevPt, tPt, u_weight, 0.0));\n\n      prevPt = tPt;\n    }\n  }\n\n  dist = min(dist, sdLine(uv, prevPt, u_mPt.xy, u_weight, 0.0));\n  dSh = min(dSh, sdLine(uv - dShTrans, prevPt, u_mPt.xy, u_weight, 0.0));\n  \n  //ideally you'd map the distance from -1 to 1 then add 0.5\n  //dont know what the range for d is tho... have a feeling it's actually pretty small\n  outColorDist = vec4(vec3(clamp(dist + 0.5,0.0,1.0)),1.0);\n\n  dist = line(dist, u_weight);\n  vec3 col = mix(vec3(1.0), u_stroke, dist);\n  dSh = (1. - smoothstep(0., 0.15, sqrt(dSh)))*.25;\n\n  if ( dist + dSh < 0.001) discard;\n\n  outColor = vec4(col * vec3(max(dSh, dist)), (dist + dSh) * u_opacity);\n}",pLineStub="\n#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\n// uniform vec3 u_resolution;\n// uniform vec3 u_dPt;\n\nuniform sampler2D u_eTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform float u_opacity;\n\nuniform vec3 u_idCol;\nuniform float u_sel;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdLine+"\n"+sdCircle+"\n"+filterLine+"\n"+drawPt+"\n\n//$INSERT FUNCTION$------\n\n//$ENDINSERT FUNCTION$---\n\nvec4 sceneDist(vec2 uv) {\n  float d = 1.0;\n  //xyz:color, w:cumulative distance \n  vec4 colDist = vec4(1.);\n  //index in parameters texture\n  vec2 index = vec2(0.);\n  //$INSERT CALL$------\n  //$ENDINSERT CALL$---\n  return colDist;\n}\n\nvoid main(){\n  outColor = vec4(u_idCol, 1.0);\n  vec2 uv = v_texcoord;\n\n  vec4 scene = sceneDist(uv);\n\n  vec3 col = scene.xyz;\n  float dist = line(scene.w, u_weight);\n\n  // comment out for background color\n  // if ( dist < 0.001){\n  //   discard;\n  // }\n\n  // typ. rendering style\n  outColor = vec4(col * vec3(dist), dist * u_opacity);\n  outColorDist = vec4(vec3(clamp(scene.w + 0.5,0.0,1.0)), 1.0 - clamp(scene.w, 0.0, 1.0));\n\n  // uncomment for background color\n  // outColor = vec4(mix(u_idCol, col, dist), dist * u_opacity, 0.375));\n}",rectangleEdit="#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_mPt;\n\nuniform sampler2D u_eTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\nuniform float u_radius;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdCircle+"\n"+sdBox+"\n"+filterLine+"\n"+filterFill+"\n\n//smooth sdf Iso\nvec3 sdf(vec2 uv, float d){\n  vec3 col = vec3(1.0) - sign(d)*vec3(0.1,0.4,0.7);\n\tcol *= 1.0 - exp(-3.0*abs(d));\n\tcol *= 0.8 + 0.2*cos(150.0*d);\n\tcol = mix( col, vec3(1.0), 1.0-smoothstep(0.0,0.003,abs(d)));\n  return col;\n}\n\n\nvoid main(){\n  outColor = vec4(1.0);\n  vec2 uv = v_texcoord;\n  "+transformUV+"\n\n  float texelOffset = 0.5 * (1. / (16. * 16.));\n\n  vec2 topLeft = texture(u_eTex, vec2(texelOffset, texelOffset)).xy;\n  vec2 rect = vec2(0.20225, 0.125);\n  vec2 flipX = vec2(-1.0, -1.0);\n\n  vec2 center = u_mPt.xy - rect * flipX;\n\n  float dist = sdBox(uv, center, rect, u_radius);\n\n  if(topLeft.x != 0.0){\n    center = 0.5 * (u_mPt.xy - topLeft.xy) + topLeft.xy;\n    vec2 rPt = abs(u_mPt.xy - center);\n    dist = sdBox(uv, center, rPt, u_radius);\n  }\n\n  //stroke\n  float stroke = line(dist, u_weight);\n  vec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n  float fill = fillMask(dist);\n  \n  vec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n  // vec4 fillCol = vec4(sdf(uv, dist), 0.5);\n\n  dist = min(stroke, fill);\n\n  // if ( dist + fill < 0.01) discard;\n\n  outColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n  outColorDist = vec4(vec3(fill),1.0);\n}",rectangleStub="#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_scale;\n\nuniform sampler2D u_eTex;\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform vec3 u_fill;\nuniform float u_opacity;\nuniform float u_radius;\n\nuniform vec3 u_idCol;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n\n"+sdCircle+"\n"+sdBox+"\n"+filterLine+"\n"+filterFill+"\n"+drawPt+"\n\nvoid main(){\n  outColor = vec4(u_idCol, 0.125);\n  vec2 uv = v_texcoord;\n\n  float d = 0.0;\n\n  //$INSERT CALL$------\n\n  //$ENDINSERT CALL$---\n  \n  outColorDist = vec4(vec3(d),1.0);\n}",simpleVert="#version 300 es\n\nin vec4 a_position;\nin vec2 a_texcoord;\n\nuniform mat4 u_matrix;\nuniform mat4 u_textureMatrix;\n\nout vec2 v_texcoord;\n\nvoid main() {\n  gl_Position = u_matrix * a_position;\n  v_texcoord = (u_textureMatrix * vec4(a_texcoord, 0, 1)).xy;\n}";__webpack_require__("./node_modules/core-js/modules/es.typed-array.float32-array.js");function bakeGlyph_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function bakeGlyph_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return bakeGlyph_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bakeGlyph_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function bakeGlyph_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function bake(glyph){var prim=draw_state.scene.editItems.find((function(e){return e.id===glyph.id}));switch(glyph.primType){case"polyline":default:return polyLine(prim,glyph);case"polygon":return function polygon(prim,glpyh){var shader=getFragStub(prim.type,!1),parameters=glpyh.uniforms.u_eTex;return shader=function polygonFunc(prim,shader,parameters){var insString="//$INSERT FUNCTION$------",insIndex=shader.indexOf(insString);insIndex+=insString.length;var startShader=shader.slice(0,insIndex),endShader=shader.slice(insIndex),exFuncStr="//$START-"+prim.id.substr(0,7),exFuncIndex=shader.indexOf(exFuncStr);if(exFuncIndex>=0){startShader=shader.slice(0,exFuncIndex);var postFuncStr="//$END-"+prim.id.substr(0,7),postIndex=shader.indexOf(postFuncStr);postIndex+=postFuncStr.length,endShader=shader.slice(postIndex)}var posString="\n";posString+="//$START-"+prim.id.substr(0,7)+"\n";var indexX=0,indexY=0,texelOffset=1/(parameters.dataSize*parameters.dataSize)*.5,dataSize=parameters.dataSize;posString+="vec4 pgon"+prim.id.substr(0,7)+"(vec2 uv, vec2 p) {",posString+="\n\tvec2 tUv = uv - p;\n";var _step,cTexel=0,_iterator=bakeGlyph_createForOfIteratorHelper(prim.pts);try{for(_iterator.s();!(_step=_iterator.n()).done;){_step.value;0!=cTexel?(posString+="\n\tindex = vec2("+(indexX=cTexel%dataSize/dataSize+texelOffset)+","+(indexY=Math.floor(cTexel/dataSize)/dataSize+texelOffset)+");\n",posString+="\tpos = texture(u_eTex, index).xy;\n",posString+="\te = oldPos - pos;\n",posString+="\tw = tUv - pos;\n",posString+="\tb = w - e*clamp( dot(w,e)/dot(e,e), 0.0, 1.0 );\n",posString+="\td = min(d, dot(b,b));\n",posString+="\tcond = bvec3( tUv.y>=pos.y, tUv.y<oldPos.y, e.x*w.y>e.y*w.x );\n",posString+="\tif(all(cond) || all(not(cond))) s*=-1.0;\n",posString+="\toldPos = pos;\n",cTexel++):(indexX=cTexel%dataSize/dataSize+texelOffset,indexY=Math.floor(cTexel/dataSize)/dataSize+texelOffset,posString+="\n\tvec2 pos = vec2(0.0);",posString+="\n\tfloat accumD = 100.0;",posString+="\n\tvec2 index = vec2("+indexX+","+indexY+");\n",posString+="\tvec2 first = texture(u_eTex, index).xy;\n",posString+="\n\tindex = vec2("+(indexX=parameters.cTexel%dataSize/dataSize+texelOffset)+","+(indexY=Math.floor(parameters.cTexel/dataSize)/dataSize+texelOffset)+");\n",posString+="\tvec2 last = texture(u_eTex, index).xy;\n",posString+="\tfloat d = dot(tUv - first, tUv - first);\n",posString+="\tfloat s = 1.0;\n",posString+="\tvec2 oldPos = first;\n",posString+="\tvec2 e = last - first;\n",posString+="\tvec2 w = tUv - first;\n",posString+="\tvec2 b = w - e*clamp( dot(w,e)/dot(e,e), 0.0, 1.0 );\n",posString+="\td = min(d, dot(b,b));\n",posString+="\tbvec3 cond = bvec3( tUv.y>=first.y, tUv.y<last.y, e.x*w.y>e.y*w.x );\n",posString+="\tif(all(cond) || all(not(cond))) s*=-1.0;\n",cTexel++)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return posString+="\td = s*sqrt(d);\n",posString+="\treturn vec4(d);\n",posString+="\n}\n",posString+="//$END-"+prim.id.substr(0,7)+"\n",(startShader+=posString)+endShader}(prim,shader,parameters),shader=function polygonCall(prim,shader){var insString="//$INSERT CALL$------",insIndex=shader.indexOf(insString);insIndex+=insString.length;var startShader=shader.slice(0,insIndex),endShader=shader.slice(insIndex),posString="\n";return posString+="\t colDist = pgon"+prim.id.substr(0,7)+" (uv, vec2(0., 0.));\n",(startShader+=posString)+endShader}(prim,shader),shader}(prim,glyph);case"circle":return function circleCall(prim,glyph){var shader=getFragStub(prim.type,!1),parameters=glyph.uniforms.u_eTex,dataSize=glyph.uniforms.u_eTex.dataSize,texelOffset=1/(parameters.dataSize*parameters.dataSize)*.5,insString="//$INSERT CALL$------",insIndex=shader.indexOf(insString);insIndex+=insString.length;var startShader=shader.slice(0,insIndex),endShader=shader.slice(insIndex),posString="\n",indexX=0%dataSize/dataSize+texelOffset,indexY=Math.floor(0/dataSize)/dataSize+texelOffset;return posString+="\tvec2 pos = vec2("+indexX+", "+indexY+");\n",indexX=1%dataSize/dataSize+texelOffset,indexY=Math.floor(1/dataSize)/dataSize+texelOffset,posString+="\tvec2 rad = vec2("+indexX+", "+indexY+");\n",posString+="\tfloat radius = distance(texture(u_eTex, pos).xy, texture(u_eTex, rad).xy);\n",posString+="\td = sdCircle(uv - vec2(0., 0.), texture(u_eTex, pos).xy, radius);\n",posString+="\tfloat stroke = line(d, u_weight);\n",posString+="\tvec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n",posString+="\tfloat fill = fillMask(d);",posString+="\tvec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n",posString+="\td = min(stroke, fill);\n",posString+="\tif ( d > 1.) discard;\n",(startShader+=posString+="\toutColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n")+endShader}(prim,glyph);case"ellipse":return function ellipseCall(prim,glyph){var shader=getFragStub(prim.type,!1),parameters=glyph.uniforms.u_eTex,dataSize=glyph.uniforms.u_eTex.dataSize,texelOffset=1/(parameters.dataSize*parameters.dataSize)*.5,insString="//$INSERT CALL$------",insIndex=shader.indexOf(insString);insIndex+=insString.length;var startShader=shader.slice(0,insIndex),endShader=shader.slice(insIndex),posString="\n",indexX=0%dataSize/dataSize+texelOffset,indexY=Math.floor(0/dataSize)/dataSize+texelOffset;return posString+="\tvec2 cIndex = vec2("+indexX+", "+indexY+");\n",indexX=1%dataSize/dataSize+texelOffset,indexY=Math.floor(1/dataSize)/dataSize+texelOffset,posString+="\tvec2 dIndex = vec2("+indexX+", "+indexY+");\n",posString+="\tvec2 center = texture(u_eTex, cIndex).xy;\n",posString+="\tvec2 dims = texture(u_eTex, dIndex).xy;\n",posString+="\td = sdEllipse(uv - vec2(0., 0.) - center, max(abs(dims - center), vec2(0.01,0.01)));\n",posString+="\tfloat stroke = line(d, u_weight);\n",posString+="\tvec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n",posString+="\tfloat fill = fillMask(d);",posString+="\tvec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n",posString+="\td = min(stroke, fill);\n",(startShader+=posString+="\toutColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n")+endShader}(prim,glyph);case"rectangle":return function rectangleCall(prim,glyph){var shader=getFragStub(prim.type,!1),parameters=glyph.uniforms.u_eTex,dataSize=glyph.uniforms.u_eTex.dataSize,texelOffset=1/(parameters.dataSize*parameters.dataSize)*.5,insString="//$INSERT CALL$------",insIndex=shader.indexOf(insString);insIndex+=insString.length;var startShader=shader.slice(0,insIndex),endShader=shader.slice(insIndex),posString="\n",indexX=0%dataSize/dataSize+texelOffset,indexY=Math.floor(0/dataSize)/dataSize+texelOffset,index=indexX+", "+indexY;return posString+="\tvec2 rect1 = texture(u_eTex, vec2("+index+")).xy;\n",indexX=1%dataSize/dataSize+texelOffset,indexY=Math.floor(1/dataSize)/dataSize+texelOffset,posString+="\tvec2 rect2 = texture(u_eTex, vec2("+(index=indexX+", "+indexY)+")).xy;\n",posString+="\tvec2 center = 0.5 * (rect2 - rect1) + rect1;\n",posString+="\tvec2 rPt = abs(rect2 - center);\n",posString+="\td = sdBox(uv - vec2(0., 0.), center, rPt, u_radius);\n",posString+="\tfloat stroke = line(d, u_weight);\n",posString+="\tvec4 strokeCol = mix(vec4(vec3(1.),0.), vec4(u_stroke,stroke) , stroke);\n",posString+="\tfloat fill = fillMask(d);",posString+="\tvec4 fillCol = mix(vec4(vec3(1.),0.), vec4(u_fill, u_opacity), fill);\n",posString+="\td = min(stroke, fill);\n",posString+="\tif ( d > 1.) discard;\n",(startShader+=posString+="\toutColor = vec4(vec3(fillCol.rgb * strokeCol.rgb), fillCol.a + strokeCol.a);\n")+endShader}(prim,glyph);case"img":return void console.log("bake glyph should not be called on an img prim.");case"pointlight":return void console.log("bake pointlight not yet implemented.")}}function polyLine(prim,glyph){var shader=getFragStub(prim.type,!1);return shader=function polyLineFunc(prim,shader,parameters){var insString="//$INSERT FUNCTION$------",insIndex=shader.indexOf(insString);insIndex+=insString.length;var startShader=shader.slice(0,insIndex),endShader=shader.slice(insIndex),exFuncStr="//$START-"+prim.id.substr(0,7),exFuncIndex=shader.indexOf(exFuncStr);if(exFuncIndex>=0){startShader=shader.slice(0,exFuncIndex);var postFuncStr="//$END-"+prim.id.substr(0,7),postIndex=shader.indexOf(postFuncStr);postIndex+=postFuncStr.length,endShader=shader.slice(postIndex)}var posString="\n";posString+="//$START-"+prim.id.substr(0,7)+"\n",posString+="vec4 pline"+prim.id.substr(0,7)+"(vec2 uv, vec2 p) {",posString+="\n\tvec2 tUv = uv - p;";for(var texelOffset=1/(parameters.dataSize*parameters.dataSize)*.5,dataSize=parameters.dataSize,cTexel=0;cTexel<prim.pts.length;cTexel++)0!=cTexel?(posString+="\n\tindex = vec2("+(cTexel%dataSize/dataSize+texelOffset)+","+(Math.floor(cTexel/dataSize)/dataSize+texelOffset)+");",posString+="\n\tpos = texture(u_eTex, index).xy;",posString+="\n\td = sdLine(tUv, oldPos, pos, u_weight, 0.0);",posString+="\n\taccumD = min(accumD, d);",posString+="\n\toldPos = pos;"):(posString+="\n\tvec3 finalColor = vec3(1.0);",posString+="\n\tvec2 pos = vec2(0.0);",posString+="\n\tfloat d = 0.0;",posString+="\n\tfloat accumD = 100.0;",posString+="\n\tvec2 index = vec2("+(cTexel%dataSize/dataSize+texelOffset)+","+(Math.floor(cTexel/dataSize)/dataSize+texelOffset)+");",posString+="\n\tvec2 oldPos = texture(u_eTex, index).xy;");return posString+="\n\tfinalColor = mix(finalColor, u_stroke, line(accumD, u_weight));",posString+="\n\treturn vec4(finalColor, accumD);",posString+="\n}\n",posString+="//$END-"+prim.id.substr(0,7)+"\n",(startShader+=posString)+endShader}(prim,shader,glyph.uniforms.u_eTex),shader=function polyLineCall(prim,shader){var insString="//$INSERT CALL$------",insIndex=shader.indexOf(insString);insIndex+=insString.length;var startShader=shader.slice(0,insIndex),endShader=shader.slice(insIndex),posString="\n";return posString+="\t colDist = pline"+prim.id.substr(0,7)+"(uv, vec2(0.0, 0.0));\n",(startShader+=posString)+endShader}(prim,shader),shader}function glyph_slicedToArray(arr,i){return function glyph_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function glyph_iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function glyph_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return glyph_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return glyph_arrayLikeToArray(o,minLen)}(arr,i)||function glyph_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function glyph_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function glyph_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function glyph_createClass(Constructor,protoProps,staticProps){return protoProps&&glyph_defineProperties(Constructor.prototype,protoProps),staticProps&&glyph_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}var draw_canvas,ctx,draw_ui,draw_view,gl,draw_resolution,glyph_Glyph=glyph_createClass((function Glyph(prim,vert,frag,_order,_uniforms){!function glyph_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Glyph);var uniforms=_uniforms||getUniforms(prim);if("object"!=typeof prim||"string"!=typeof vert||"string"!=typeof frag||"object"!=typeof uniforms)return console.log("glyph constructor is invalid, check inputs"),console.log("prim: ",prim),console.log("vert: ",vert),console.log("frag: ",frag),void console.log("uniforms: ",uniforms);this.order=_order||0,this.active=!0,this.visible=!0,this.primType=prim.type.slice(),this.vert=vert.slice(),this.frag=frag.slice(),this.uniforms=Object.assign({},uniforms);var ptsLength=16;prim.pts&&prim.pts.length>0&&(ptsLength=2*Math.ceil(Math.sqrt(prim.pts.length)/2)),prim.id?this.id=prim.id.slice():this.id=uuid(),this.uniforms.u_eTex&&(this.uniforms.u_eTex=new primitives_PolyPoint(ptsLength),this.uniforms.u_cTex=this.uniforms.u_eTex.cTexel),this.uniforms.u_idCol&&(this.uniforms.u_idCol=twgl_full_module.q.copy(prim.idCol)),this.bbox,void 0!==prim.pts&&prim.pts.length&&this.uniforms.u_eTex&&this.uniforms.u_eTex.addPoints(prim.pts),this.translate=prim.translate||twgl_full_module.q.create(),this.matrix=twgl_full_module.j.ortho(0,gl.canvas.clientWidth,gl.canvas.clientHeight,0,-1,1),this.matrix=twgl_full_module.j.translate(this.matrix,twgl_full_module.q.create(0,0,0)),this.matrix=twgl_full_module.j.scale(this.matrix,twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,1)),this.uniforms.u_matrix=this.matrix,this.programInfo=twgl_full_module.d(gl,[vert,frag]);var arrays={position:{numComponents:2,data:new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1])},texcoord:{numComponents:2,data:new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1])}},bufferInfo=twgl_full_module.b(gl,arrays);this.bufferInfo=bufferInfo,this.vertexArrayInfo=twgl_full_module.f(gl,this.programInfo,this.bufferInfo)}));function updateMatrices(glyph,_asImg){var asImg=_asImg||!1,prim=draw_state.scene.editItems.find((function(item){return item.id===glyph.id})),minX=draw_dPt[0]*draw_resolution.y,minY=draw_dPt[1]*draw_resolution.y,wOrigin=twgl_full_module.q.create(minX,minY),fX=32/draw_dPt[2]*draw_resolution.y,fY=32/draw_dPt[2]*draw_resolution.y,fact=twgl_full_module.q.create(fX,fY),lOrigin=twgl_full_module.q.subtract(glyph.bbox.min.v3,twgl_full_module.q.create());twgl_full_module.q.multiply(lOrigin,fact,lOrigin),glyph.matrix=twgl_full_module.j.ortho(0,gl.canvas.clientWidth,gl.canvas.clientHeight,0,-1,1),twgl_full_module.j.translate(glyph.matrix,wOrigin,glyph.matrix);var translate=twgl_full_module.q.multiply(prim.translate,fact);twgl_full_module.q.add(lOrigin,translate,translate),twgl_full_module.j.translate(glyph.matrix,translate,glyph.matrix);var width=glyph.bbox.width*fX,height=glyph.bbox.height*fY;glyph.matrix=twgl_full_module.j.scale(glyph.matrix,twgl_full_module.q.create(width,height,1)),glyph.uniforms.u_matrix=glyph.matrix;var denominator=32*draw_resolution.y,scaleX=width*draw_dPt[2]/denominator,scaleY=height*draw_dPt[2]/denominator,origin=twgl_full_module.q.subtract(glyph.bbox.min.v3,twgl_full_module.q.create()),texMatrix=twgl_full_module.j.identity();"img"===glyph.primType||asImg||(twgl_full_module.j.translate(texMatrix,origin,texMatrix),twgl_full_module.j.scale(texMatrix,twgl_full_module.q.create(scaleX,scaleY,1),texMatrix)),glyph.uniforms.u_textureMatrix=texMatrix}function bakeGlyph(glyph){glyph.bbox=new primitives_bbox(glyph,.05),updateMatrices(glyph);var fs=bake(glyph);glyph.frag=fs,glyph.programInfo=twgl_full_module.d(gl,[glyph.vert,fs]);var matrix=twgl_full_module.j.identity();twgl_full_module.j.scale(matrix,twgl_full_module.q.create(2,2,1),matrix),twgl_full_module.j.translate(matrix,twgl_full_module.q.create(-.5,-.5,0),matrix),glyph.uniforms.u_matrix=matrix,gl.useProgram(glyph.programInfo.program),twgl_full_module.p(glyph.programInfo,glyph.uniforms);var _renderGlyph=function renderGlyph(glyph){glyph.active=!0;var factor=32/draw_dPt[2]*gl.canvas.height,targetWidth=Math.floor(glyph.bbox.width*factor),targetHeight=Math.floor(glyph.bbox.height*factor),rgbaTexture=twgl_full_module.e(gl,{level:0,width:targetWidth,height:targetHeight,min:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE}),distTexture=twgl_full_module.e(gl,{level:0,width:targetWidth,height:targetHeight,min:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE}),glyphBuffer=twgl_full_module.c(gl,[{attachment:rgbaTexture,attachmentPoint:gl.COLOR_ATTACHMENT0},{attachment:distTexture,attachmentPoint:gl.COLOR_ATTACHMENT1}],targetWidth,targetHeight);return twgl_full_module.a(gl,glyphBuffer),gl.drawBuffers([gl.COLOR_ATTACHMENT0,gl.COLOR_ATTACHMENT1]),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),twgl_full_module.h(gl,[glyph]),[rgbaTexture,distTexture]}(glyph),_renderGlyph2=glyph_slicedToArray(_renderGlyph,2),imgSrc=_renderGlyph2[0],distImgSrc=_renderGlyph2[1];updateMatrices(glyph,!0),glyph.programInfo=twgl_full_module.d(gl,[glyph.vert,getFragStub("img")]),glyph.uniforms=getUniforms({type:"img",imgSrc:imgSrc,distImgSrc:distImgSrc}),gl.useProgram(glyph.programInfo.program),twgl_full_module.p(glyph.programInfo,glyph.uniforms)}function createGlyph(prim,order,_edit){var edit=void 0===_edit||_edit,fs=getFragStub(prim.type,edit),vs=simpleVert.slice();return new glyph_Glyph(prim,vs,fs,order)}function getFragStub(type,edit){switch(type){case"polyline":return edit?pLineEdit.slice():pLineStub.slice();case"polygon":return edit?polygonEdit.slice():polygonStub.slice();case"circle":return edit?circleEdit.slice():circleStub.slice();case"ellipse":return edit?ellipseEdit.slice():ellipseStub.slice();case"rectangle":return edit?rectangleEdit.slice():rectangleStub.slice();case"pointlight":return pointLightEdit.slice();case"img":return"#version 300 es\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform sampler2D u_img;\nuniform sampler2D u_distImg;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\nlayout(location = 1) out vec4 outColorDist;\n \nvoid main() {\n  vec2 uv = v_texcoord;\n\n  // TODO: eventually we'll have u_dist texture\n  // when a new image is loaded some kind of distance texture will\n  // be generated, may or may not be useful\n  \n  outColorDist = texture(u_distImg, uv);\n  outColor = texture(u_img, uv);\n}".slice();default:return pLineStub.slice()}}function getUniforms(prim){var type=prim.type,texMatrix=twgl_full_module.j.identity(),properties=Object.assign({},prim.properties);switch(type){case"polyline":return{u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_mPt:twgl_full_module.q.create(draw_mPt.x,draw_mPt.y,0),u_dPt:twgl_full_module.q.create(draw_dPt[0],draw_dPt[1],32),u_eTex:{},u_cTex:-1,u_weight:properties.weight,u_opacity:properties.opacity,u_stroke:chroma_default()(properties.stroke).gl().slice(0,3),u_sel:properties.sel};case"polygon":return{u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_mPt:twgl_full_module.q.create(draw_mPt.x,draw_mPt.y,0),u_dPt:twgl_full_module.q.create(draw_dPt[0],draw_dPt[1],32),u_eTex:{},u_cTex:-1,u_weight:properties.weight,u_opacity:properties.opacity,u_stroke:chroma_default()(properties.stroke).gl().slice(0,3),u_fill:chroma_default()(properties.fill).gl().slice(0,3)};case"circle":case"ellipse":return{u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_mPt:twgl_full_module.q.create(draw_mPt[0],draw_mPt[1],0),u_dPt:twgl_full_module.q.create(draw_dPt[0],draw_dPt[1],32),u_eTex:{},u_cTex:-1,u_weight:properties.weight,u_opacity:properties.opacity,u_stroke:chroma_default()(properties.stroke).gl().slice(0,3),u_fill:chroma_default()(properties.fill).gl().slice(0,3)};case"rectangle":return{u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_mPt:twgl_full_module.q.create(draw_mPt.x,draw_mPt.y,0),u_dPt:twgl_full_module.q.create(draw_dPt[0],draw_dPt[1],32),u_eTex:{},u_cTex:-1,u_weight:properties.weight,u_opacity:properties.opacity,u_stroke:chroma_default()(properties.stroke).gl().slice(0,3),u_fill:chroma_default()(properties.fill).gl().slice(0,3),u_radius:.01};case"pointlight":return{u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_mPt:twgl_full_module.q.create(draw_mPt.x,draw_mPt.y,0),u_dPt:twgl_full_module.q.create(draw_dPt[0],draw_dPt[1],32),u_eTex:{},u_distTex:{},u_cTex:-1,u_weight:properties.weight,u_opacity:properties.opacity,u_stroke:chroma_default()(properties.stroke).gl().slice(0,3),u_fill:chroma_default()(properties.fill).gl().slice(0,3),u_radius:.01};case"img":return{u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_img:prim.imgSrc,u_distImg:prim.distImgSrc};default:return{u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_mPt:twgl_full_module.q.create(draw_mPt.x,draw_mPt.y,0),u_dPt:twgl_full_module.q.create(draw_dPt[0],draw_dPt[1],32),u_eTex:{},u_weight:properties.weight,u_opacity:properties.opacity,u_stroke:chroma_default()(properties.stroke).gl().slice(0,3)}}}function draw_toConsumableArray(arr){return function draw_arrayWithoutHoles(arr){if(Array.isArray(arr))return draw_arrayLikeToArray(arr)}(arr)||function draw_iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||draw_unsupportedIterableToArray(arr)||function draw_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function draw_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return draw_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?draw_arrayLikeToArray(o,minLen):void 0}}function draw_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var store,draw_state,dispatch,glyphs,distBuffer,distTex,sceneTex,setParentState,draw_mPt=twgl_full_module.q.create(0,0,0),draw_dPt=new twgl_full_module.q.create(0,0,32),ptTree=new rbush_min_default.a,bboxTree=new rbush_min_default.a,resize=!1;function middleWare(_ref){var getState=_ref.getState;return function(next){return function(action){var returnVal=next(action),newState=getState();if(newState.scene.editItems.forEach((function(item){item.pts.length<1&&newState.scene.editItem!==item.id&&console.log(item)})),"EDIT_TRANSLATE"!==action.subtype){var selActions=["EDIT_SELECTAPND","EDIT_SELECTCLR","EDIT_SELECTREPLACE","EDIT_SELECTRMV","EDIT_SETSEL","EDIT_HOVERCLR","EDIT_HOVERSET"];return"scene"!==action.type||selActions.includes(action.subtype)||"function"!=typeof setParentState||(draw_updateDataStructures(newState),setParentState((function(state){return Object.assign({},state,{scene:newState.scene})}))),"history"===action.type&&"function"==typeof setParentState&&("HISTORY_PUSH"!==action.subType&&draw_updateDataStructures(newState),setParentState((function(state){return Object.assign({},state,{history:newState.history})}))),action.type===ui&&"function"==typeof setParentState&&setParentState((function(state){return Object.assign({},state,{ui:newState.ui})})),returnVal}}}}var draw_updateDataStructures=function updateDataStructures(state){ptTree=new rbush_min_default.a;var pts=state.scene.editItems.reduce((function(prev,curr,index,arr){return state.ui.dragging&&state.scene.selected.includes(curr.id)?prev:[].concat(draw_toConsumableArray(prev),draw_toConsumableArray(curr.pts.map((function(p,i,a){return addVec(p,curr.translate)}))))}),[]);ptTree.load(pts),bboxTree=new rbush_min_default.a;var boxes=state.scene.editItems.reduce((function(prev,curr,index,arr){return state.scene.editItem===curr.id||0===curr.pts.length?prev:[].concat(draw_toConsumableArray(prev),[new primitives_bbox(curr)])}),[]);return bboxTree.load(boxes),function updateGlyphs(){glyphs=glyphs.sort((function(a,b){return a.order-b.order}));var editItemIDs=draw_state.scene.editItems.map((function(item){return item.id})),glyphIDs=glyphs.map((function(glyph){return glyph.id}));glyphs=glyphs.filter((function(glyph){return editItemIDs.includes(glyph.id)||"grid"===glyph.primType||"ui"===glyph.primType})),draw_state.scene.editItems.forEach((function(item,i){if(!glyphIDs.includes(item.id)){var glyph=createGlyph(item,i,item.id===draw_state.scene.editItem);item.pts&&item.pts.length>0&&"img"===item.type&&(glyph.bbox=new primitives_bbox(item),updateMatrices(glyph)),glyphs.push(glyph)}}));var editGlyphIndex=glyphs.findIndex((function(g){return g.id===draw_state.scene.editItem}));if(editGlyphIndex>-1&&glyphs[editGlyphIndex].bbox instanceof primitives_bbox){var editing=draw_state.scene.editItems.find((function(i){return i.id===draw_state.scene.editItem}));if(!editing)return;glyphs[editGlyphIndex]=createGlyph(editing,editGlyphIndex)}glyphs.forEach((function(glyph,i,a){if(!(glyph.bbox instanceof primitives_bbox)&&glyph.id!==draw_state.scene.editItem&&"grid"!==glyph.primType&&"ui"!==glyph.primType){if("img"===glyph.primType)return;if(glyph.uniforms.u_eTex.pts.length>0){var prim=draw_state.scene.editItems.find((function(item){return item.id===glyph.id}));if(!prim)return;updateGlyphUniforms(glyph,prim),bakeGlyph(glyph)}}}))}(),state};function addImage(_src,dims,evPt){var src,image;if("string"==typeof _src)src=_src;else src="../assets/textures/leaves.jpg";var texMatrix=twgl_full_module.j.translation(twgl_full_module.q.create(0,0,0));texMatrix=twgl_full_module.j.scale(texMatrix,twgl_full_module.q.create(1,1,1)),image=twgl_full_module.e(gl,{src:src,color:[.125,.125,.125,.125]},(function(){})),twgl_full_module.i(gl,image),evPt.x=evPt.x/draw_resolution.x*(draw_resolution.x/draw_resolution.y)-draw_dPt[0],evPt.y=evPt.y/draw_resolution.y-draw_dPt[1],evPt.x=evPt.x*(draw_dPt[2]/32),evPt.y=evPt.y*(draw_dPt[2]/32),function drawImage(img,dims,evPt){var width=dims.width,height=dims.height,pt0=new primitives_vec(evPt.x,evPt.y),pt1=new primitives_vec(evPt.x+width,evPt.y+height),imgPrim=new primitives_prim("img",[pt0,pt1]);imgPrim.imgSrc=img,imgPrim.distImgSrc=img,dispatch(scenePushEditItem(imgPrim,draw_state.scene.editItem))}(image,{width:dims.width/dims.height,height:1},evPt)}function draw_update(){draw_ui.update();var selDist=function sceneDist(){var selPrim,_step,dist=1e3,mouse={minX:draw_mPt[0],maxX:draw_mPt[0],minY:draw_mPt[1],maxY:draw_mPt[1]},bboxSearch=bboxTree.search(mouse).map((function(b){return b.id})),_iterator=function draw_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=draw_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(draw_state.scene.editItems.filter((function(i){return bboxSearch.includes(i.id)})));try{for(_iterator.s();!(_step=_iterator.n()).done;){var prim=_step.value;if(prim.id!==draw_state.scene.editItem){var currDist=distPrim(draw_mPt,prim);currDist<dist&&(selPrim=prim,dist=currDist)}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return{d:dist,sel:selPrim}}();selDist.d<.01&&"select"===draw_state.ui.mode&&selDist.sel?draw_state.scene.hover!==selDist.sel.id&&(document.getElementById("canvas-container").style.cursor="grab",dispatch(function editHoverSet(id){return{type:"scene",subtype:"EDIT_HOVERSET",id:id}}(selDist.sel.id))):""!==draw_state.scene.hover&&(document.getElementById("canvas-container").style.cursor="auto",dispatch({type:"scene",subtype:"EDIT_HOVERCLR"})),function updateCtx(selDist){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.font="14px Arial";var pixelPt={x:0,y:0},dist=selDist.d,selPrim=selDist.sel;pixelPt.x=(draw_mPt[0]*(32/draw_dPt[2])+draw_dPt[0])*draw_resolution.y,pixelPt.y=(draw_mPt[1]*(32/draw_dPt[2])+draw_dPt[1])*draw_resolution.y,ctx.fillStyle="black";var mPtString=(32*draw_mPt[0]/2).toFixed(2)+'" x '+(32*draw_mPt[1]/2).toFixed(2)+'"';ctx.fillText("Dims: "+mPtString,pixelPt.x+12,pixelPt.y),void 0!==selPrim&&dist<0&&(ctx.fillStyle=selPrim.idColHex,ctx.fillText(selPrim.type+": "+selPrim.id,pixelPt.x+12,pixelPt.y+14))}(selDist),(resize=twgl_full_module.k(gl.canvas))&&(twgl_full_module.k(ctx.canvas),twgl_full_module.l(gl,distTex,{level:0,width:gl.canvas.width,height:gl.canvas.height,min:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE}),twgl_full_module.l(gl,sceneTex,{level:0,width:gl.canvas.width,height:gl.canvas.height,min:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE}),vecSet(draw_resolution,gl.canvas.width,gl.canvas.height))}function updateGlyphUniforms(glyph,prim){var _needsUpdate=!1;function needsUpdate(){_needsUpdate||(gl.useProgram(glyph.programInfo.program),_needsUpdate=!0)}if(!resize||void 0===glyph.uniforms.u_resolution||glyph.uniforms.u_resolution[0]===gl.canvas.width&&glyph.uniforms.u_resolution[1]===gl.canvas.height||(needsUpdate(),glyph.uniforms.u_resolution[0]=gl.canvas.width,glyph.uniforms.u_resolution[1]=gl.canvas.height),void 0===glyph.uniforms.u_dPt||glyph.uniforms.u_dPt[0]===draw_dPt[0]&&glyph.uniforms.u_dPt[1]===draw_dPt[1]&&glyph.uniforms.u_dPt[2]===draw_dPt[2]||(needsUpdate(),glyph.uniforms.u_dPt=draw_dPt),void 0===glyph.uniforms.u_mPt||glyph.uniforms.u_mPt[0]===draw_mPt[0]&&glyph.uniforms.u_mPt[1]===draw_mPt[1]||(needsUpdate(),glyph.uniforms.u_mPt[0]=draw_mPt[0],glyph.uniforms.u_mPt[1]=draw_mPt[1]),"object"!=typeof glyph.uniforms.u_boxSel||glyph.uniforms.u_boxSel[0]===draw_state.ui.boxSel[0]&&glyph.uniforms.u_boxSel[1]===draw_state.ui.boxSel[1]&&glyph.uniforms.u_boxSel[2]===draw_state.ui.boxSel[2]||(needsUpdate(),glyph.uniforms.u_boxSel=twgl_full_module.q.copy(draw_state.ui.boxSel)),"number"==typeof glyph.uniforms.u_boxState&&glyph.uniforms.u_boxState!==draw_state.ui.boxSelectState&&(needsUpdate(),glyph.uniforms.u_boxState=draw_state.ui.boxSelectState),"object"==typeof glyph.uniforms.u_stroke){var stroke=chroma_default()(prim.properties.stroke).gl().slice(0,3);glyph.uniforms.u_stroke[0]===stroke[0]&&glyph.uniforms.u_stroke[1]===stroke[1]&&glyph.uniforms.u_stroke[2]===stroke[2]||(needsUpdate(),glyph.uniforms.u_stroke=stroke)}if("object"==typeof glyph.uniforms.u_fill){var fill=chroma_default()(prim.properties.fill).gl().slice(0,3);glyph.uniforms.u_fill[0]===fill[0]&&glyph.uniforms.u_fill[1]===fill[1]&&glyph.uniforms.u_fill[2]===fill[2]||(needsUpdate(),glyph.uniforms.u_fill=fill)}if("number"==typeof glyph.uniforms.u_weight&&glyph.uniforms.u_weight!==prim.properties.weight&&(needsUpdate(),glyph.uniforms.u_weight=prim.properties.weight),"number"==typeof glyph.uniforms.u_opacity&&glyph.uniforms.u_opacity!==prim.properties.opacity&&(needsUpdate(),glyph.uniforms.u_opacity=prim.properties.opacity),"number"==typeof glyph.uniforms.u_radius&&glyph.uniforms.u_radius!==prim.properties.radius&&(needsUpdate(),glyph.uniforms.u_radius=prim.properties.radius),"object"==typeof glyph.uniforms.u_distTex&&(needsUpdate(),glyph.uniforms.u_distTex=distTex),glyph.uniforms.u_eTex instanceof primitives_PolyPoint){prim.pts.forEach((function(p,i){var uPt=glyph.uniforms.u_eTex.getPoint(i);uPt.x===p.x&&uPt.y===p.y||(needsUpdate(),glyph.uniforms.u_eTex.addPoint(p,prim.id,i))}));for(var i=0;i<glyph.uniforms.u_cTex-(prim.pts.length-1);i++)needsUpdate(),glyph.uniforms.u_eTex.popPoint()}"number"==typeof glyph.uniforms.u_sel&&(draw_state.scene.selected.includes(prim.id)&&glyph.uniforms.u_sel<1?(needsUpdate(),glyph.uniforms.u_sel+=.15):draw_state.scene.hover===prim.id&&glyph.uniforms.u_sel<.7?(needsUpdate(),glyph.uniforms.u_sel+=.06):glyph.uniforms.u_sel>0&&(needsUpdate(),glyph.uniforms.u_sel-=.15)),"number"==typeof glyph.uniforms.u_cTex&&glyph.uniforms.u_cTex!==prim.pts.length-1&&(needsUpdate(),glyph.uniforms.u_cTex=prim.pts.length-1),_needsUpdate&&twgl_full_module.p(glyph.programInfo,glyph.uniforms)}var saveDist=!1;function draw_draw(){var bboxSearch=bboxTree.search(draw_view).map((function(b){return b.id}));glyphs.forEach((function(g){var prim=draw_state.scene.editItems.find((function(a){return a.id===g.id}));prim&&prim.properties.visible!==g.visible&&(g.visible=prim.properties.visible),g.active&&(g.bbox instanceof primitives_bbox&&updateMatrices(g,!0),"ui"===g.primType&&(prim=draw_state.scene.editItems.find((function(a){return a.id===draw_state.scene.editItem}))),updateGlyphUniforms(g,prim))})),glyphs.forEach((function(g){g.active=bboxSearch.includes(g.id)&&g.visible||draw_state.scene.editItem===g.id&&"draw"===draw_state.ui.mode,"grid"===g.primType&&(g.active=draw_state.ui.showGrid),"ui"===g.primType&&(g.active=!0)})),glyphs.sort((function(a,b){return a.order-b.order})),twgl_full_module.a(gl,distBuffer),gl.drawBuffers([gl.COLOR_ATTACHMENT0,gl.COLOR_ATTACHMENT1]),gl.clearColor(1,1,1,0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),glyphs.forEach((function(g){if(g.active&&!["grid","ui","pointlight"].includes(g.primType)){var programInfo=g.programInfo;gl.useProgram(programInfo.program),twgl_full_module.p(programInfo,g.uniforms),twgl_full_module.m(gl,programInfo,g.vertexArrayInfo),twgl_full_module.g(gl,g.vertexArrayInfo)}})),saveDist&&(!function saveWebGLTexture(img,dims){var width=Math.floor(dims.width),height=Math.floor(dims.height),fbo=twgl_full_module.c(gl,[{attachment:img}],width,height),data=new Uint8Array(width*height*4);gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,data),gl.deleteFramebuffer(fbo.framebuffer);var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;var context=canvas.getContext("2d",{colorSpace:"display-p3"}),imageData=context.createImageData(width,height);imageData.data.set(data),context.putImageData(imageData,0,0),canvas.toBlob((function(blob){return saveBlob(blob,"webGLTexture.png")})),canvas.remove()}(distTex,{width:gl.canvas.clientWidth,height:gl.canvas.clientHeight}),saveDist=!1),twgl_full_module.a(gl,null),gl.clearColor(1,1,1,0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),glyphs.forEach((function(g){if(g.active){var programInfo=g.programInfo;gl.useProgram(programInfo.program),twgl_full_module.p(programInfo,g.uniforms),twgl_full_module.m(gl,programInfo,g.vertexArrayInfo),twgl_full_module.g(gl,g.vertexArrayInfo)}}))}function render(){draw_update(),draw_draw(),requestAnimationFrame(render)}function scrollPan(e){e.preventDefault(),e.stopPropagation(),dispatch(uiTargetHome(!1)),e.ctrlKey?draw_dPt[2]=Math.max(1,draw_dPt[2]+.1*e.deltaY):(draw_dPt[0]+=.001*e.deltaX,draw_dPt[1]+=.001*e.deltaY),draw_view={minX:(0-draw_dPt[0])*draw_dPt[2]/32,minY:(0-draw_dPt[1])*draw_dPt[2]/32,maxX:(draw_resolution.x/draw_resolution.y-draw_dPt[0])*draw_dPt[2]/32,maxY:(1-draw_dPt[1])*draw_dPt[2]/32}}function zoomToBbox(bbox){var res={x:gl.canvas.clientWidth,y:gl.canvas.clientHeight},dH=32*bbox.width*gl.canvas.height/gl.canvas.width,dZ=32*bbox.height,dX=dispToValue(bbox.minX,32,dZ),dY=dispToValue(bbox.minY,32,dZ);if(bbox.width>=bbox.height&&function sceneToDeviceScalar(size,zoom,scale,resolution){return size*(scale/zoom*resolution.y)}(bbox.height,dH,32,res)<res.y){dZ=dH,dX=dispToValue(bbox.minX,32,dZ);var centerY=(deviceToSceneScalar(res.y,dZ,32,res)-bbox.height)/2;dY=dispToValue(bbox.minY-centerY,32,dZ)}else{var centerX=(deviceToSceneScalar(res.x,dZ,32,res)-bbox.width)/2;dX=dispToValue(bbox.minX-centerX,32,dZ)}var target=twgl_full_module.q.create(dX,dY,dZ);dispatch(function uiSetTarget(target){return{type:ui,subtype:"UI_SETTARGET",target:target}}(target)),dispatch(uiTargetHome(!0))}function zoomToFit(){dispatch(uiTargetHome(!1));var pts=ptTree.all();if(draw_state.scene.selected.length>0){var filtered=pts.filter((function(pt){return draw_state.scene.selected.includes(pt.pId)}));pts=filtered.length>0?filtered:pts}zoomToBbox(new primitives_bbox({pts:pts,type:"polyline",id:"scene-box"}))}function screenshotDirect(_callback){var callback=null!=_callback?_callback:function(blob){saveBlob(blob,"screencapture-"+draw_canvas.width+"x"+draw_canvas.height+".png")};draw_draw(),draw_canvas.toBlob(callback)}var saveBlob=function(){if("undefined"!=typeof window){var a=document.createElement("a");return document.body.appendChild(a),a.style.display="none",function saveData(blob,fileName){if("undefined"!=typeof window){var url=window.URL.createObjectURL(blob);a.href=url,a.download=fileName,a.click()}}}}();var float16=__webpack_require__("./node_modules/@petamoriken/float16/browser/float16.mjs");function primitives_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=primitives_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function primitives_toConsumableArray(arr){return function primitives_arrayWithoutHoles(arr){if(Array.isArray(arr))return primitives_arrayLikeToArray(arr)}(arr)||function primitives_iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||primitives_unsupportedIterableToArray(arr)||function primitives_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function primitives_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return primitives_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?primitives_arrayLikeToArray(o,minLen):void 0}}function primitives_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function primitives_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function primitives_createClass(Constructor,protoProps,staticProps){return protoProps&&primitives_defineProperties(Constructor.prototype,protoProps),staticProps&&primitives_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function primitives_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function uuid(){if("undefined"==typeof window)return"";var d=(new Date).getTime(),d2=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(c){var r=16*Math.random();return d>0?(r=(d+r)%16|0,d=Math.floor(d/16)):(r=(d2+r)%16|0,d2=Math.floor(d2/16)),("x"===c?r:3&r|8).toString(16)}))}var ENDD=!1,primitives_vec=primitives_createClass((function vec(x,y,z,w,pId,id){primitives_classCallCheck(this,vec),this.v3=twgl_full_module.q.create(x,y,0),sync(this,"x",this.v3,0),sync(this,"y",this.v3,1),sync(this,"z",this.v3,2),sync(this,"w",this.v3,2),sync(this,"minX",this.v3,0,!0),sync(this,"maxX",this.v3,0,!0),sync(this,"minY",this.v3,1,!0),sync(this,"maxY",this.v3,1,!0),this.pId=pId||"",this.id=id||uuid()}));function cloneVec(v){var w=void 0!==v.w?v.w:0;return new primitives_vec(v.v3[0],v.v3[1],v.v3[2],w,v.pId,v.id)}function vecSet(vec,x,y,z,w){return vec.x=x||vec.x,vec.y=y||vec.y,vec.z=z||vec.z,vec.w=w||vec.w,vec.v3=twgl_full_module.q.create(vec.x,vec.y,vec.z),vec}function lengthVec(_vec){return Math.sqrt(_vec.x*_vec.x+_vec.y*_vec.y)}function normVec(_vec){var vec=cloneVec(_vec),l=lengthVec(vec);return vec.x=vec.x/l,vec.y=vec.y/l,vec}function angleVec(_vec){return Math.atan2(-_vec.y,-_vec.x)+Math.PI}function addVec(a,b){var x,y;return b.x?(x=a.x+b.x,y=a.y+b.y):(x=a.x+b[0],y=a.y+b[1]),Object.assign({},a,{x:x,y:y,minX:x,maxX:x,minY:y,maxY:y,v3:twgl_full_module.q.create(x,y,0)})}var primitives_bbox=primitives_createClass((function bbox(prim,_padding){primitives_classCallCheck(this,bbox);var points=prim.pts?primitives_toConsumableArray(prim.pts):primitives_toConsumableArray(prim.uniforms.u_eTex.pts),type=prim.type?prim.type:prim.primType,padding=_padding||.05,translate=prim.translate||twgl_full_module.q.create(0,0,0);if(!prim.id)throw new Error("Bounding box created with no object Id");switch(this.id=prim.id.slice(),type){case"polyline":case"polygon":points.sort((function(a,b){return a.x<b.x?-1:1})),this.minX=points[0].x-padding+translate[0],this.maxX=points[points.length-1].x+padding+translate[0],points.sort((function(a,b){return a.y<b.y?-1:1})),this.minY=points[0].y-padding+translate[1],this.maxY=points[points.length-1].y+padding+translate[1];break;case"circle":var radius=function distVec(a,b){var dx=a.x-b.x,dy=a.y-b.y;return Math.sqrt(dx*dx+dy*dy)}(points[0],points[1]);this.minX=points[0].x-radius-padding+translate[0],this.maxX=points[0].x+radius+padding+translate[0],this.minY=points[0].y-radius-padding+translate[1],this.maxY=points[0].y+radius+padding+translate[1];break;case"ellipse":var dims=absV3(twgl_full_module.q.subtract(points[0].v3,points[1].v3));this.minX=points[0].x-dims[0]-padding+translate[0],this.maxX=points[0].x+dims[0]+padding+translate[0],this.minY=points[0].y-dims[1]-padding+translate[1],this.maxY=points[0].y+dims[1]+padding+translate[1];break;case"rectangle":this.minX=Math.min(points[0].x,points[1].x)-padding+translate[0],this.maxX=Math.max(points[0].x,points[1].x)+padding+translate[0],this.minY=Math.min(points[0].y,points[1].y)-padding+translate[1],this.maxY=Math.max(points[0].y,points[1].y)+padding+translate[1];break;default:this.minX=points[0].x+translate[0],this.minY=points[0].y+translate[0],this.maxX=points[1].x+translate[1],this.maxY=points[1].y+translate[1]}this.min=new primitives_vec(this.minX,this.minY),this.max=new primitives_vec(this.maxX,this.maxY),this.width=this.maxX-this.minX,this.height=this.maxY-this.minY})),propsDefault={type:"",filter:"",stroke:"#1d2b53",fill:"#FBD045",weight:2e-4,radius:.001,opacity:1,sel:0,visible:!0},primitives_prim=primitives_createClass((function prim(type,pts,_props,id,_translate,_imgSrc){primitives_classCallCheck(this,prim),this.type=type,this.pts=pts||[],this.properties=_props||Object.assign({},propsDefault),this.id=id||uuid();var idCol=chroma.random();this.idCol=twgl_full_module.q.create(idCol.gl()[0],idCol.gl()[1],idCol.gl()[2]),this.idColHex=idCol.hex(),this.translate=_translate?twgl_full_module.q.create(_translate[0],_translate[1],_translate[2]):twgl_full_module.q.create(),this.metaData={name:"",index:"",csi:"",uniformat:""},this.imgSrc=_imgSrc||void 0})),primitives_PolyPoint=function(){function PolyPoint(_dataSize){primitives_classCallCheck(this,PolyPoint),this.dataSize=_dataSize||16,this.pts=[],this.cTexel=-1,this.data=new Uint16Array(4*this.dataSize*this.dataSize),this.texture=twgl_full_module.e(gl,{unpackAlignnment:4,minMag:gl.NEAREST,src:this.data,width:this.dataSize,height:this.dataSize,wrap:gl.CLAMP_TO_EDGE,internalFormat:gl.RGBA16F,format:gl.RGBA,type:gl.HALF_FLOAT}),this.id=uuid()}return primitives_createClass(PolyPoint,[{key:"addPoint",value:function addPoint(_pt,pId,_texel){var x=_pt?_pt.x:0,y=_pt?_pt.y:0,z=_pt&&_pt.z?_pt.z:0,w=_pt&&_pt.z?_pt.w:0,pt=new primitives_vec(x,y,z,w,pId),index=0;void 0!==_texel?(index=4*_texel,this.cTexel=Math.max(this.cTexel,_texel),this.pts[_texel]=pt):(this.cTexel++,index=4*this.cTexel,this.pts.push(pt));var buffer=new ArrayBuffer(64),view=new DataView(buffer);return view.getFloat16=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return float16.a.apply(void 0,[view].concat(args))},view.setFloat16=function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return float16.b.apply(void 0,[view].concat(args))},view.setFloat16(0,x,ENDD),view.setFloat16(16,y,ENDD),view.setFloat16(32,z,ENDD),view.setFloat16(48,w,ENDD),this.data[index]=view.getUint16(0,ENDD),this.data[index+1]=view.getUint16(16,ENDD),this.data[index+2]=view.getUint16(32,ENDD),this.data[index+3]=view.getUint16(48,ENDD),twgl_full_module.o(gl,this.texture,this.data,{internalFormat:gl.RGBA16F,format:gl.RGBA,type:gl.HALF_FLOAT}),pt}},{key:"addPoints",value:function addPoints(pts){if(pts&&pts.length){var size=Math.ceil(Math.sqrt(pts.length)),data=new Uint16Array(4*size*size);this.dataSize=size;var buffer=new ArrayBuffer(64*pts.length),view=new DataView(buffer);view.getFloat16=function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return float16.a.apply(void 0,[view].concat(args))},view.setFloat16=function(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];return float16.b.apply(void 0,[view].concat(args))};for(var i=0;i<pts.length;i++){var _pts$i=pts[i],x=_pts$i.x,y=_pts$i.y,z=_pts$i.z,w=_pts$i.w;view.setFloat16(64*i+0,x,ENDD),view.setFloat16(64*i+16,y,ENDD),view.setFloat16(64*i+32,z,ENDD),view.setFloat16(64*i+48,w,ENDD),data[i+3*i]=view.getUint16(64*i+0,ENDD),data[i+3*i+1]=view.getUint16(64*i+16,ENDD),data[i+3*i+2]=view.getUint16(64*i+32,ENDD),data[i+3*i+3]=view.getUint16(64*i+48,ENDD)}this.data=data,twgl_full_module.o(gl,this.texture,this.data,{internalFormat:gl.RGBA16F,format:gl.RGBA,type:gl.HALF_FLOAT})}}},{key:"popPoint",value:function popPoint(){var index=4*this.cTexel,buffer=new ArrayBuffer(64),view=new DataView(buffer);view.getFloat16=function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return float16.a.apply(void 0,[view].concat(args))},view.setFloat16=function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return float16.b.apply(void 0,[view].concat(args))},view.setFloat16(0,0,ENDD),view.setFloat16(16,0,ENDD),view.setFloat16(32,0,ENDD),view.setFloat16(48,0,ENDD),this.data[index]=view.getUint16(0,ENDD),this.data[index+1]=view.getUint16(16,ENDD),this.data[index+2]=view.getUint16(32,ENDD),this.data[index+3]=view.getUint16(48,ENDD),twgl_full_module.o(gl,this.texture,this.data,{internalFormat:gl.RGBA16F,format:gl.RGBA,type:gl.HALF_FLOAT}),this.cTexel--,this.pts.pop()}},{key:"getPoint",value:function getPoint(index){var texel=4*index,buffer=new ArrayBuffer(64),view=new DataView(buffer);return view.getFloat16=function(){return Object(float16.a)(view,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])},view.setFloat16=function(){return Object(float16.b)(view,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])},this.data.slice(texel,texel+4).forEach((function(d,i){view.setUint16(16*i,d,ENDD)})),[view.getFloat16(0,ENDD),view.getFloat16(16,ENDD),view.getFloat16(32,ENDD),view.getFloat16(48,ENDD)]}}]),PolyPoint}();function distPrim(_mPt,prim){var mPt={};mPt=_mPt.x?twgl_full_module.q.create(_mPt.x,_mPt.y,_mPt.z):_mPt;var tPt=twgl_full_module.q.subtract(mPt,prim.translate),dist=1e3;switch(prim.type){case"polyline":dist=Math.min(dist,function pLineDist(mPt,prim){if("polyline"!=prim.type)return 1e3;var prev,_step,dist=1e3,_iterator=primitives_createForOfIteratorHelper(prim.pts);try{for(_iterator.s();!(_step=_iterator.n()).done;){var p=_step.value;if(void 0!==prev){var lD=lineDist(mPt,prev,p,prim.properties.weight);dist=Math.min(dist,lD),prev=p}else prev=p}}catch(err){_iterator.e(err)}finally{_iterator.f()}return dist}(tPt,prim));break;case"polygon":dist=Math.min(dist,function polygonDist(mPt,prim){var prev=twgl_full_module.q.copy(prim.pts[prim.pts.length-1].v3),first=twgl_full_module.q.copy(prim.pts[0].v3);first=twgl_full_module.q.subtract(mPt,first);var _step2,dist=twgl_full_module.q.dot(first,first),s=1,_iterator2=primitives_createForOfIteratorHelper(prim.pts);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _p=_step2.value,p=twgl_full_module.q.copy(_p.v3),e=twgl_full_module.q.subtract(prev,p),w=twgl_full_module.q.subtract(mPt,p),b=twgl_full_module.q.subtract(w,twgl_full_module.q.mulScalar(e,clamp(twgl_full_module.q.dot(w,e)/twgl_full_module.q.dot(e,e),0,1)));dist=Math.min(dist,twgl_full_module.q.dot(b,b));var c={x:mPt[1]>=p[1],y:mPt[1]<prev[1],z:e[0]*w[1]>e[1]*w[0]};(c.x&&c.y&&c.z||!c.x&&!c.y&&!c.z)&&(s*=-1),prev=p}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return dist=s*Math.sqrt(dist)}(tPt,prim));break;case"circle":dist=Math.min(dist,function circleDist(mPt,prim){var ptA=twgl_full_module.q.copy(prim.pts[0].v3),ptB=twgl_full_module.q.copy(prim.pts[1].v3),radius=twgl_full_module.q.distance(ptA,ptB),uv=twgl_full_module.q.subtract(mPt,ptA);return twgl_full_module.q.length(uv)-radius}(tPt,prim));break;case"ellipse":dist=Math.min(dist,function ellipseDist(mPt,prim){var ptA=twgl_full_module.q.copy(prim.pts[0].v3),ptB=twgl_full_module.q.copy(prim.pts[1].v3),e=twgl_full_module.q.max(twgl_full_module.q.subtract(ptB,ptA),twgl_full_module.q.create(.1,.1,1));e[2]=1;var pAbs=absV3(twgl_full_module.q.subtract(mPt,ptA));pAbs[2]=1;for(var ei=twgl_full_module.q.divide(twgl_full_module.q.create(1,1,1),e),e2=twgl_full_module.q.multiply(e,e),ve=twgl_full_module.q.multiply(ei,twgl_full_module.q.create(e2[0]-e2[1],e2[1]-e2[0],1)),t=twgl_full_module.q.create(.7071067811865475,.7071067811865475,1),i=0;i<3;i++){var v=twgl_full_module.q.multiply(ve,t);twgl_full_module.q.multiply(v,t,v),twgl_full_module.q.multiply(v,t,v);var u=twgl_full_module.q.normalize(twgl_full_module.q.subtract(pAbs,v));twgl_full_module.q.mulScalar(u,twgl_full_module.q.length(twgl_full_module.q.subtract(twgl_full_module.q.multiply(t,e),v)),u);var w=twgl_full_module.q.multiply(ei,twgl_full_module.q.add(v,u));t=twgl_full_module.q.normalize(clampV3(w,0,1))}var nearestAbs=twgl_full_module.q.multiply(t,e);nearestAbs[2]=1;var dist=twgl_full_module.q.length(twgl_full_module.q.subtract(pAbs,nearestAbs));return twgl_full_module.q.dot(pAbs,pAbs)<twgl_full_module.q.dot(nearestAbs,nearestAbs)?-1*dist:dist}(tPt,prim));break;case"rectangle":case"img":dist=Math.min(dist,rectDist(tPt,prim))}return dist}function rectDist(mPt,prim){var ptA=twgl_full_module.q.copy(prim.pts[0].v3),ptB=twgl_full_module.q.copy(prim.pts[1].v3),center=twgl_full_module.q.add(twgl_full_module.q.mulScalar(twgl_full_module.q.subtract(ptB,ptA),.5),ptA),b=twgl_full_module.q.subtract(ptB,center);b=twgl_full_module.q.create(Math.abs(b[0]),Math.abs(b[1]));var radius=twgl_full_module.q.create(prim.properties.radius,prim.properties.radius);twgl_full_module.q.subtract(b,radius,b);var uv=twgl_full_module.q.subtract(mPt,center),d=twgl_full_module.q.subtract(twgl_full_module.q.create(Math.abs(uv[0]),Math.abs(uv[1])),b);return twgl_full_module.q.length(twgl_full_module.q.max(d,twgl_full_module.q.create(0,0)))+Math.min(Math.max(d[0],d[1]),0)-radius[0]}function lineDist(p,_a,_b,w){var a=twgl_full_module.q.copy(_a.v3),b=twgl_full_module.q.copy(_b.v3),pa=twgl_full_module.q.subtract(p,a),ba=twgl_full_module.q.subtract(b,a),h=clamp(twgl_full_module.q.dot(pa,ba)/twgl_full_module.q.dot(ba,ba),0,1);return twgl_full_module.q.length(twgl_full_module.q.subtract(pa,twgl_full_module.q.mulScalar(ba,h)))-w}function clamp(a,low,high){return Math.min(Math.max(a,low),high)}function clampV3(a,_min,_max){var min=twgl_full_module.q.create(_min,_min,0),max=twgl_full_module.q.create(_max,_max,0);return twgl_full_module.q.min(twgl_full_module.q.max(a,min),max)}function absV3(a){return twgl_full_module.q.create(Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2]))}function sync(target,tProp,source,sProp){return Object.defineProperty(target,tProp,{enumerable:!1,configurable:!0,get:function get(){return source[sProp]},set:function set(value){source[sProp]=value}}),target}function reducers_toConsumableArray(arr){return function reducers_arrayWithoutHoles(arr){if(Array.isArray(arr))return reducers_arrayLikeToArray(arr)}(arr)||function reducers_iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function reducers_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return reducers_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return reducers_arrayLikeToArray(o,minLen)}(arr)||function reducers_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function reducers_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var historyInit={past:[],future:[]},uiInit={dragging:!1,dragStart:!1,dragOrigin:twgl_full_module.q.create(),targeting:!1,target:twgl_full_module.q.create(0,0,64),mode:"draw",boxSel:twgl_full_module.q.create(0),boxSelectState:0,snapPt:!1,snapGlobal:!1,snapGlobalAngle:45,snapGrid:!1,snapRef:!1,snapRefAngle:15,snapDist:!1,snapDistXVal:1,snapDistYVal:1,showGrid:!0},cursorInit={pos:new primitives_vec(0,0),grid:new primitives_vec(0,0,0,0),scale:64},sceneInit={editItem:"",editItems:[],hover:{},selected:[]},initialState={ui:uiInit,cursor:cursorInit,scene:sceneInit,history:historyInit};function reducers_ui(){var _state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0,state=_state.ui;switch(action.subtype){case"UI_SNAPDIST":return Object.assign({},state,{snapDist:!action.toggle});case"UI_SNAPDISTXVAL":return Object.assign({},state,{snapDistXVal:action.value});case"UI_SNAPDISTYVAL":return Object.assign({},state,{snapDistYVal:action.value});case"UI_SNAPGLOBAL":return Object.assign({},state,{snapGlobal:!state.snapGlobal});case"UI_SNAPREF":return Object.assign({},state,{snapRef:!state.snapRef});case"UI_SNAPGRID":return Object.assign({},state,{snapGrid:!state.snapGrid});case"UI_SNAPPT":return Object.assign({},state,{snapPt:!state.snapPt});case"UI_TARGETHOME":return Object.assign({},state,{targeting:action.toggle});case"UI_SETTARGET":return Object.assign({},state,{target:action.target});case"UI_MODE":return Object.assign({},state,{mode:action.mode});case"UI_DRAGGING":return Object.assign({},state,{dragging:action.toggle});case"UI_DRAGSTART":return Object.assign({},state,{dragStart:action.toggle,dragOrigin:twgl_full_module.q.copy(action.pt)});case"UI_BOXSELECT":return Object.assign({},state,{boxSel:twgl_full_module.q.copy(action.vec2),boxSelectState:action.int});case"UI_GRIDTOGGLE":return Object.assign({},state,{showGrid:action.toggle});default:return state}}function reducers_cursor(){var _state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0,state=_state.cursor;switch(action.subtype){case"CURSOR_GRIDSCALE":return Object.assign({},state,{scale:action.int});case"CURSOR_GRID":return Object.assign({},state,{grid:{x:2/action.scale,y:2/action.scale,z:action.scale,w:2/action.scale*.1}});default:return state}}function reducers_scene(){var _state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0,state=_state.scene;switch(action.subtype){case"SCENE_SETEDITITEM":return Object.assign({},state,{editItem:action.editItem});case"SCENE_ADDPT":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{pts:[].concat(reducers_toConsumableArray(item.pts),reducers_toConsumableArray(action.pts))})}))});case"SCENE_PUSHMANY":return Object.assign({},state,{editItems:[].concat(reducers_toConsumableArray(state.editItems),reducers_toConsumableArray(action.items))});case"SCENE_PUSHEDITITEM":return Object.assign({},state,{editItems:[].concat(reducers_toConsumableArray(state.editItems),[Object.assign({},action.prim)]),editItem:"string"==typeof action.edit?action.edit.slice():action.prim.id.slice()});case"SCENE_RMVITEM":return Object.assign({},state,{editItems:state.editItems.filter((function(i){return!action.id.includes(i.id)})),selected:state.selected.filter((function(i){return!action.id.includes(i.id)}))});case"SCENE_ESCITEM":return Object.assign({},state,{editItem:action.newEditItem.id.slice(),editItems:state.editItems.map((function(i){return i.id!==action.id?Object.assign({},i):Object.assign({},action.newEditItem)})),selected:state.selected.map((function(i){return i!==action.id?i.slice():action.newEditItem.id.slice()}))});case"SCENE_CLEAR":return Object.assign({},state,{editItems:[],editItem:"",selected:[]});case"EDIT_WEIGHT":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{weight:action.weight})})}))});case"EDIT_RADIUS":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{radius:action.radius})})}))});case"EDIT_OPACITY":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{opacity:action.opacity})})}))});case"EDIT_VISIBLE":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{visible:action.toggle})})}))});case"EDIT_FILL":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{fill:action.hex})})}))});case"EDIT_STROKE":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{stroke:action.hex.slice()})})}))});case"EDIT_SETSEL":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{sel:action.state})})}))});case"EDIT_FILTER":return Object.assign({},state,{editItems:state.editItems.map((function(item){return item.id!==action.id?Object.assign({},item):Object.assign({},item,{properties:Object.assign({},item.properties,{filter:action.filter})})}))});case"EDIT_HOVERSET":return Object.assign({},state,{hover:action.id.slice()});case"EDIT_HOVERCLR":return Object.assign({},state,{hover:""});case"EDIT_SELECTAPND":var sel=[].concat(reducers_toConsumableArray(state.selected),reducers_toConsumableArray(action.sel));return Object.assign({},state,{selected:sel.filter((function(id,i){return sel.indexOf(id)===i}))});case"EDIT_SELECTREPLACE":return Object.assign({},state,{selected:reducers_toConsumableArray(action.sel)});case"EDIT_SELECTRMV":return Object.assign({},state,{selected:state.selected.filter((function(item){return item!==action.sel}))});case"EDIT_SELECTCLR":return Object.assign({},state,{selected:[]});case"EDIT_TRANSLATE":return Object.assign({},state,{editItems:state.editItems.map((function(item){if(item.id!==action.id)return Object.assign({},item);var translate=twgl_full_module.q.add(item.translate,action.v3,twgl_full_module.q.create());return Object.assign({},item,{translate:translate})}))});default:return state}}function reducers_history(){var _state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0,state={scene:_state.scene,history:_state.history};switch(action.subtype){case"HISTORY_UNDO":var past=state.history.past.map((function(i){return Object.assign({},i)})),_scene=Object.assign({},past.pop());return Object.keys(_scene).length<=0?{}:Object.assign({},state,{scene:_scene,history:{future:[].concat(reducers_toConsumableArray(state.history.future.map((function(i){return Object.assign({},i)}))),[Object.assign({},state.scene)]),past:past}});case"HISTORY_REDO":var future=state.history.future.map((function(i){return Object.assign({},i)})),_scene2=Object.assign({},future.pop());return Object.keys(_scene2).length<=0?{}:Object.assign({},state,{scene:_scene2,history:{future:future,past:[].concat(reducers_toConsumableArray(state.history.past.map((function(i){return Object.assign({},i)}))),[Object.assign({},state.scene)])}});case"HISTORY_PUSH":return{history:{past:[].concat(reducers_toConsumableArray(_state.history.past.map((function(i){return Object.assign({},i)}))),[Object.assign({},action.pastScene)]),future:[]}};default:return state}}var reducers_reducer=function reducer(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;if(!state)return console.error("Reducer got null state. Should be initialized"),initialState;switch(action.type){case"cursor":return Object.assign({},state,{cursor:reducers_cursor(state,action)});case ui:return Object.assign({},state,{ui:reducers_ui(state,action)});case"scene":return Object.assign({},state,{scene:reducers_scene(state,action)});case"history":return Object.assign({},state,reducers_history(state,action));default:return state}};var dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-context-menu/dist/index.module.js"),Root=dist_index_module.c,Content=dist_index_module.a,Trigger=dist_index_module.d,ContextMenu_ContextMenu=(dist_index_module.b,function ContextMenu(_ref){var trigger=_ref.trigger,children=_ref.children;return react_default.a.createElement(Root,null,react_default.a.createElement(Trigger,{asChild:!0},trigger),react_default.a.createElement(Content,{style:{backgroundColor:"var(--color-grey1)",borderRadius:4,border:"1px solid var(--color-warmblue)",padding:"8px 12px",display:"flex",flexDirection:"column",gap:4,minWidth:160}},children))}),react_slider_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-slider/dist/index.module.js"),Slider_Root=react_slider_dist_index_module.b,Track=react_slider_dist_index_module.d,Range=react_slider_dist_index_module.a,Thumb=react_slider_dist_index_module.c,Slider_Slider=function Slider(_ref){var value=_ref.value,onValueChange=_ref.onValueChange,style=_ref.style;return react_default.a.createElement(Slider_Root,{style:Object(objectSpread2.a)({position:"relative",display:"flex",alignItems:"center",userSelect:"none",touchAction:"none",height:16,width:"100%"},style),value:value,orientation:"horizontal",onValueChange:onValueChange},react_default.a.createElement(Track,{style:{backgroundColor:"var(--color-grey5)",position:"relative",flexGrow:1,borderRadius:999,height:3}},react_default.a.createElement(Range,{style:{position:"absolute",backgroundColor:"var(--color-warmblue)",borderRadius:999,height:"100%"}})),react_default.a.createElement(Thumb,{style:{display:"block",width:16,height:16,backgroundColor:"var(--color-warmblue)",boxShadow:"0 2px 10px var(--color-grey5)",borderRadius:10}}))},InputLabel_Root=__webpack_require__("./node_modules/@radix-ui/react-label/dist/index.module.js").a,InputLabel_InputLabel=function InputLabel(_ref){var label=_ref.label,style=(_ref.children,_ref.style);return react_default.a.createElement(InputLabel_Root,{style:style,className:"input-label"},label)},react_colorful_dist_index_module=__webpack_require__("./node_modules/react-colorful/dist/index.module.js"),ColorSwatchButton_ColorSwatchButton=function ColorSwatchButton(_ref){var defaultValue=_ref.defaultValue,active=_ref.active,disabled=_ref.disabled,onClick=_ref.onClick,style=_ref.style,_useState=Object(react.useState)(null!=defaultValue?defaultValue:"#ffffff"),_useState2=Object(slicedToArray.a)(_useState,2),color=_useState2[0];_useState2[1];return react_default.a.createElement("button",{className:"color-swatch-button ".concat(active&&"active"),style:Object(objectSpread2.a)({backgroundColor:disabled?"var(--color-grey3)":color},style),disabled:disabled,key:color,onClick:onClick})},react_popover_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-popover/dist/index.module.js"),icons_x=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/x.js"),Popover_Root=react_popover_dist_index_module.e,Popover_Trigger=react_popover_dist_index_module.f,Anchor=react_popover_dist_index_module.a,Popover_Content=react_popover_dist_index_module.d,Close=react_popover_dist_index_module.c,Arrow=react_popover_dist_index_module.b,Popover_Popover=function Popover(_ref){var trigger=_ref.trigger,children=_ref.children;return react_default.a.createElement(Popover_Root,null,react_default.a.createElement(Popover_Trigger,{style:{backgroundColor:"none",border:"none",padding:"0",margin:"0"},asChild:!0},react_default.a.createElement(Anchor,null,trigger)),react_default.a.createElement(Popover_Content,{style:{display:"flex",flexDirection:"column",zIndex:1e3,minWidth:100,minHeight:100,background:"white",padding:0,border:"1px solid var(--color-warmblue)",borderRadius:4},side:"right"},react_default.a.createElement(Close,{asChild:!0},react_default.a.createElement(icons_x.a,{className:"icon-solo-button",style:{alignSelf:"flex-end"}})),react_default.a.createElement(Arrow,{style:{fill:"var(--color-warmblue)"}}),children))},ColorPicker_ColorPicker=function ColorPicker(_ref){var value=_ref.value,onChange=_ref.onChange,disabled=_ref.disabled,style=_ref.style;return react_default.a.createElement(Popover_Popover,{trigger:react_default.a.createElement(ColorSwatchButton_ColorSwatchButton,{defaultValue:value,disabled:disabled,style:style})},react_default.a.createElement("div",{className:"color-picker",style:{margin:0,padding:0}},react_default.a.createElement(react_colorful_dist_index_module.a,{className:"color-picker",defaultValue:value,onChange:onChange})))},regeneratorRuntime=(__webpack_require__("./node_modules/core-js/modules/es.regexp.constructor.js"),__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js")),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),dxf_parser_dist=__webpack_require__("./node_modules/dxf-parser/dist/index.js");function serializeScene(){if(document)return JSON.stringify(Object.assign({},draw_state.scene))}var loadAll=function(){var _ref=Object(asyncToGenerator.a)(Object(regeneratorRuntime.a)().mark((function _callee(scene,onProgressCallback){var callback,_loop,i;return Object(regeneratorRuntime.a)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:for(1,callback=function callback(progress,total){if(onProgressCallback)return function(){return onProgressCallback(progress,total)}},_loop=function _loop(i){requestAnimationFrame((function(){return io_loadItems(scene.slice(i,i+1),callback(i+1,scene.length))}))},i=0;i<scene.length;i+=1)_loop(i);case 4:case"end":return _context.stop()}}),_callee)})));return function loadAll(_x,_x2){return _ref.apply(this,arguments)}}(),io_loadItems=function loadItems(items,onProgressCallback){var prims=items.reduce((function(p,item,i,a){if("undefined"===item)return p;var id=uuid(),points=item.pts.map((function(p){return new primitives_vec(p.v3[0],p.v3[1],p.v3[2],0,id)})),type=item.type.slice(),prim=new primitives_prim(type,points,Object(objectSpread2.a)({},item.properties),id,item.translate);return p.push(prim),p}),[]);prims.length>0&&dispatch(function scenePushMany(items){return{type:"scene",subtype:"SCENE_PUSHMANY",items:items}}(prims)),onProgressCallback&&onProgressCallback()};function io_loadScene(data,onProgressCallback){document&&loadAll(data.editItems,onProgressCallback)}var onDrop_onDrop=function onDrop(e,container,onProgressCallback){e.preventDefault(),e.stopPropagation();var canvas=container;canvas.classList.remove("dragOver");var files=e.dataTransfer.files,testImage=new RegExp("([a-zA-Z0-9s_\\.-:()])+(.jpg|.jpeg|.png|.gif)$"),testJSON=new RegExp("([a-zA-Z0-9s_\\.-:()])+(.json)$"),testDXF=new RegExp("([a-zA-Z0-9s_\\.-:()])+(.dxf)$");if(FileReader&&files&&files.length&&testImage.test(files[0].name.toLowerCase())){var fr=new FileReader;fr.onload=function(obj){var image=new Image;image.src=fr.result,image.onload=function(){var dims={width:this.width,height:this.height},rect=canvas.getBoundingClientRect(),evPt={x:e.clientX-rect.left,y:e.clientY-rect.top};addImage(this.src,dims,evPt)}},fr.readAsDataURL(files[0])}else if(FileReader&&files&&files.length&&testJSON.test(files[0].name.toLowerCase())){var _fr=new FileReader;_fr.onload=function(e){var result=_fr.result;"string"==typeof result&&(result=JSON.parse(result.slice())),io_loadScene(result,onProgressCallback)},_fr.readAsText(files[0])}else if(FileReader&&files&&files.length&&testDXF.test(files[0].name.toLowerCase())){var _fr2=new FileReader;_fr2.onload=function(e){var result=_fr2.result;"string"==typeof result&&function loadDXF(data,onProgressCallback){if(document&&"string"==typeof data){var dxfJson=(new dxf_parser_dist.a).parseSync(data),scene=null==dxfJson?void 0:dxfJson.entities.reduce((function(p,_ref2){var type=_ref2.type,vertices=_ref2.vertices,id=uuid();return"POLYLINE"===type?(p.push(new primitives_prim("polyline",vertices.map((function(v){return new primitives_vec(v.x/32,0-v.y/32,0,0,id.slice())})),propsDefault,id.slice())),p):p}),[]);console.log(scene),scene&&loadAll(scene,onProgressCallback)}}(result,onProgressCallback)},_fr2.readAsText(files[0])}else console.log("media import failed!")},react_toolbar_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-toolbar/dist/index.module.js"),stars=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/stars.js"),aspect_ratio=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/aspect-ratio.js"),icons_cursor=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/cursor.js"),vector_pen=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/vector-pen.js"),cursor_text=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/cursor-text.js"),bounding_box=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/bounding-box.js"),magnet=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/magnet.js"),building=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/building.js"),react_tooltip_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-tooltip/dist/index.module.js"),Tooltip_Root=react_tooltip_dist_index_module.c,Tooltip_Trigger=react_tooltip_dist_index_module.d,Tooltip_Content=react_tooltip_dist_index_module.b,Tooltip_Arrow=react_tooltip_dist_index_module.a,Tooltip_Tooltip=function Tooltip(_ref){var content=_ref.content,side=_ref.side,children=_ref.children,style=_ref.style;return react_default.a.createElement(Tooltip_Root,{delayDuration:10},react_default.a.createElement(Tooltip_Trigger,{asChild:!0},children),react_default.a.createElement(Tooltip_Content,{className:"tooltip-content",portalled:!0,side:side,style:Object(objectSpread2.a)({zIndex:9999},style)},content,react_default.a.createElement(Tooltip_Arrow,{style:{fill:"var(--color-warmblue)"}})))},ToolbarButton_ToolbarButton=function ToolbarButton(_ref){var icon=_ref.icon,active=_ref.active,disabled=_ref.disabled,label=_ref.label,onClick=_ref.onClick,tooltip=_ref.tooltip;_ref.style;return tooltip?react_default.a.createElement(Tooltip_Tooltip,{content:tooltip,side:"top"},react_default.a.createElement("button",{disabled:"boolean"==typeof disabled&&disabled,className:"toolbar-button ".concat(active?"active":""),onClick:onClick,type:"button"},react_default.a.createElement("span",{className:"toolbar-icon"},icon&&icon,label&&label))):react_default.a.createElement("button",{disabled:"boolean"==typeof disabled&&disabled,className:"toolbar-button ".concat(active?"active":""),onClick:onClick,type:"button"},react_default.a.createElement("span",{className:"toolbar-icon"},icon&&icon,label&&label))},react_dropdown_menu_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-dropdown-menu/dist/index.module.js"),check_circle=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/check-circle.js"),react_separator_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-separator/dist/index.module.js"),ToolbarDropdown_TooblarDropdown=function TooblarDropdown(_ref){var options=_ref.options,onValueChange=_ref.onValueChange,triggerIcon=_ref.triggerIcon,tooltip=_ref.tooltip,style=_ref.style;return react_default.a.createElement(react_dropdown_menu_dist_index_module.e,null,react_default.a.createElement(Tooltip_Tooltip,{content:tooltip,side:"top"},react_default.a.createElement(react_dropdown_menu_dist_index_module.f,{style:Object(objectSpread2.a)(Object(objectSpread2.a)({},style),{},{display:"flex"}),className:"toolbar-button"},triggerIcon)),react_default.a.createElement(react_dropdown_menu_dist_index_module.c,{className:"dropdown-content"},options.map((function(group,i,a){return react_default.a.createElement("div",{key:i},group.map((function(o,i){return react_default.a.createElement(react_dropdown_menu_dist_index_module.b,{key:"".concat(o,"-").concat(i),className:"dropdown-item",onClick:"function"==typeof o.onClick?o.onClick:"function"==typeof onValueChange?function(){return onValueChange(o.value)}:void 0,checked:"boolean"==typeof o.checked&&o.checked,disabled:"boolean"==typeof o.disabled&&o.disabled},react_default.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyItems:"center",width:16,padding:0,margin:0}},void 0!==o.icon?o.icon:react_default.a.createElement(react_dropdown_menu_dist_index_module.d,{style:{display:"flex"}},react_default.a.createElement(check_circle.a,null))),o.label?o.label:o.value.charAt(0).toUpperCase()+o.value.slice(1),react_default.a.createElement("div",{style:{marginLeft:"auto",paddingLeft:20}},o.keyCut))})),i!==a.length-1&&react_default.a.createElement(react_separator_dist_index_module.b,{className:"separator-02"}))})),react_default.a.createElement(react_dropdown_menu_dist_index_module.a,{style:{fill:"var(--color-warmblue)"}})))},AlignToolbar_AlignToolbar=function AlignToolbar(_ref){var state=_ref.state,_ref$visible=_ref.visible,visible=void 0===_ref$visible||_ref$visible,currentPrimType=Object(react.useMemo)((function(){var currItem=state.scene.editItems.find((function(i){return i.id===state.scene.editItem}));return currItem?currItem.type:null}),[state.scene]),switchPrimType=function switchPrimType(primSel){var currItem=state.scene.editItems.find((function(i){return i.id===state.scene.editItem}));if(currItem.type!=primSel){var newPrim=new primitives_prim(primSel,[],Object(objectSpread2.a)({},currItem.properties));currItem&&currItem.pts.length>1?dispatch(scenePushEditItem(newPrim)):dispatch(sceneEscItem(currItem.id,newPrim))}},primTypes=[[{value:"polyline",checked:"polyline"===currentPrimType},{value:"polygon",checked:"polygon"===currentPrimType},{value:"rectangle",checked:"rectangle"===currentPrimType},{value:"circle",checked:"circle"===currentPrimType},{value:"ellipse",checked:"ellipse"===currentPrimType}],[{label:"Point Light",value:"pointlight",checked:"pointlight"===currentPrimType,disabled:!0}]],snapTypes=[[{label:"Points",value:"snap-point",onClick:function onClick(){return dispatch(uiSnapPt())},checked:state.ui.snapPt,keyCut:"P"},{value:"grid",onClick:function onClick(){return dispatch(uiSnapGrid())},checked:state.ui.snapGrid,keyCut:"G"},{label:"Relative Angle",value:"relative-angle",onClick:function onClick(){return dispatch(uiSnapRef())},checked:state.ui.snapRef,keyCut:"S"},{label:"Global Angle",value:"global-angle",onClick:function onClick(){return dispatch(uiSnapGlobal())},checked:state.ui.snapGlobal,keyCut:"Shift"}]],moreTypes=[[{label:"Undo",value:"undo",disabled:state.history.past.length<1,onClick:function onClick(){dispatch({type:"history",subtype:"HISTORY_UNDO"})},keyCut:"⌘+Z",icon:state.history.past.length<10?state.history.past.length:"9+"},{label:"Redo",value:"redo",disabled:state.history.future.length<1,onClick:function onClick(){dispatch({type:"history",subtype:"HISTORY_REDO"})},keyCut:"⌘+Y",icon:state.history.future.length<10?state.history.future.length:"9+"}],[{label:"Show Grid",value:"show-grid",onClick:function onClick(){dispatch(function uiGridToggle(toggle){return{type:ui,subtype:"UI_GRIDTOGGLE",toggle:toggle}}(!state.ui.showGrid))}}],[{label:"Screenshot",value:"screenshot",onClick:function onClick(){screenshotDirect()},keyCut:"L"},{label:"Screenshot Distance",value:"screenshot-dist",onClick:function onClick(){!function saveDistTex(){saveDist=!0}()}},{label:"Save Public",value:"save-public",onClick:function onClick(){serializeScene()},disabled:!0}],[{label:"Download .json",value:"download-json",onClick:function onClick(){var json=serializeScene();if(void 0!==json){var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(json),downloadAnchor=document.getElementById("downloadAnchor");downloadAnchor&&(downloadAnchor.setAttribute("href",dataStr),downloadAnchor.setAttribute("download","drawing.json"),downloadAnchor.click())}}},{label:"Download .dxf",value:"download-dxf",disabled:!0,icon:react_default.a.createElement(stars.a,null)}]];return react_default.a.createElement("div",{className:"flex-row",style:{height:0,justifyContent:"center"}},react_default.a.createElement(react_toolbar_dist_index_module.a,{className:"toolbar",style:{zIndex:1,justifyContent:"space-between",backgroundColor:"var(--color-grey1)",height:"fit-content",gap:16,marginTop:16,paddingLeft:28,paddingRight:28,border:"1px solid var(--color-grey3)",borderRadius:999,boxShadow:"rgba(0, 0, 0, 0.08) 0px 8px 28px",width:"fit-content"}},react_default.a.createElement(ToolbarButton_ToolbarButton,{icon:react_default.a.createElement(aspect_ratio.a,{size:22}),disabled:!visible,onClick:function onClick(){zoomToFit()},tooltip:state.scene.selected.length>0?"Zoom to Selection":"Zoom To Fit"}),react_default.a.createElement(react_toolbar_dist_index_module.b,{type:"single",defaultValue:"draw"},react_default.a.createElement(ToolbarButton_ToolbarButton,{icon:react_default.a.createElement(icons_cursor.a,{size:22}),active:"select"===state.ui.mode,disabled:!visible,onClick:function onClick(){dispatch(uiMode("select"))},tooltip:"Select"}),react_default.a.createElement(ToolbarButton_ToolbarButton,{icon:react_default.a.createElement(vector_pen.a,{size:22}),active:"draw"===state.ui.mode,disabled:!visible,onClick:function onClick(){dispatch(uiMode("draw"))},tooltip:"Draw"}),react_default.a.createElement(ToolbarButton_ToolbarButton,{icon:react_default.a.createElement(cursor_text.a,{size:22}),active:"text"===state.ui.mode,disabled:!0,onClick:function onClick(){dispatch(uiMode("text"))},tooltip:"Text"})),react_default.a.createElement(ToolbarDropdown_TooblarDropdown,{options:primTypes,onValueChange:switchPrimType,triggerIcon:react_default.a.createElement(bounding_box.a,{size:22}),tooltip:"Shapes"}),react_default.a.createElement(ToolbarDropdown_TooblarDropdown,{options:snapTypes,triggerIcon:react_default.a.createElement(magnet.a,{size:22}),tooltip:"Snaps"}),react_default.a.createElement(ToolbarDropdown_TooblarDropdown,{options:moreTypes,onValueChange:switchPrimType,triggerIcon:react_default.a.createElement(building.a,{size:22}),tooltip:"Connect"})))},react_tabs_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-tabs/dist/index.module.js"),react_scroll_area_dist_index_module=__webpack_require__("./node_modules/@radix-ui/react-scroll-area/dist/index.module.js"),eye=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/eye.js"),eye_slash=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/eye-slash.js"),trash=__webpack_require__("./node_modules/react-bootstrap-icons/dist/icons/trash.js"),AlignSider_AlignSider=function AlignSider(_ref){var state=_ref.state,style=(_ref.visible,_ref.style),_useState=Object(react.useState)("scene"),_useState2=Object(slicedToArray.a)(_useState,2),activeTab=_useState2[0],setActiveTab=_useState2[1];return react_default.a.createElement(react_tabs_dist_index_module.a,{defaultValue:activeTab,onValueChange:function onValueChange(val){return setActiveTab(val)},style:Object(objectSpread2.a)(Object(objectSpread2.a)({},style),{},{height:"100%",visibility:open?"visible":"hidden",outlineWidth:1,zIndex:12})},react_default.a.createElement(react_tabs_dist_index_module.c,{style:{display:"flex",justifyContent:"space-around",borderBottom:"1px solid #ccc",height:54,borderRadius:"inherit"}},react_default.a.createElement(react_tabs_dist_index_module.d,{value:"scene",className:"tab-button ".concat("scene"===activeTab&&"tab-button-active"),style:{borderTopLeftRadius:8,outline:"none"}},"Scene"),react_default.a.createElement(react_tabs_dist_index_module.d,{value:"browse",className:"tab-button ".concat("browse"===activeTab&&"tab-button-active"),style:{borderTopRightRadius:8,outline:"none"}},"Browse")),react_default.a.createElement(react_tabs_dist_index_module.b,{value:"scene",asChild:!0},react_default.a.createElement("div",{className:"flex-column",style:{background:"white",borderRadius:"0px 0px 8px 8px",height:"calc(100% - 54px)",padding:"24px 16px",outline:"none"}},react_default.a.createElement(react_scroll_area_dist_index_module.a,{style:{width:"100%",height:"100%",overflow:"hidden"}},react_default.a.createElement(react_scroll_area_dist_index_module.d,{style:{width:"100%",height:"100%",borderRadius:"inherit",borderBottom:"1px solid var(--color-warning)"}},react_default.a.createElement("div",{className:"flex-row",style:{marginBottom:8}},react_default.a.createElement("span",null,"Items: ",state.scene.editItems.length),react_default.a.createElement("span",null,"Selected: ",state.scene.selected.length)),react_default.a.createElement("ul",{style:{width:"100%"}},state.scene.editItems.map((function(item,i){return item&&item.pts.length>0?react_default.a.createElement("li",{className:"flex-row",key:"".concat(item.id,"-").concat(i),style:{alignItems:"center",gap:4,justifyContent:"space-between",margin:"4px 0px",paddingRight:16}},react_default.a.createElement("button",{className:"icon-solo-button",onClick:function onClick(){dispatch(function editVisible(toggle,id){return{type:"scene",subtype:"EDIT_VISIBLE",toggle:toggle,id:id}}(!item.properties.visible,item.id))},value:item.properties.visible},item.properties.visible?react_default.a.createElement(eye.a,null):react_default.a.createElement(eye_slash.a,null)),react_default.a.createElement("div",{className:"prim-chip ".concat(state.scene.selected.includes(item.id)?"prim-chip-selected":""),onClick:function onClick(){item&&(dispatch(editSelectApnd(item.id)),zoomToBbox(new primitives_bbox(item)))}},item.type),react_default.a.createElement(ColorPicker_ColorPicker,{value:item.properties.stroke,onChange:function onChange(color){dispatch(editStroke(color,item.id))}}),react_default.a.createElement("button",{className:"icon-solo-button",onClick:function onClick(){dispatch(sceneRmvItem([item.id]))}},react_default.a.createElement(trash.a,null))):react_default.a.createElement(react_default.a.Fragment,null)})))),react_default.a.createElement(react_scroll_area_dist_index_module.b,{orientation:"vertical",className:"scroll-area-bar"},react_default.a.createElement(react_scroll_area_dist_index_module.c,{className:"scroll-area-thumb"}))))))},DrawingPanel=(__webpack_require__("./src/DrawingPanel/styles/align.css"),__webpack_require__("./src/DrawingPanel/styles/buttons.css"),__webpack_require__("./src/DrawingPanel/styles/editor.css"),__webpack_require__("./src/DrawingPanel/styles/flex.css"),__webpack_require__("./src/DrawingPanel/styles/menu.css"),__webpack_require__("./src/DrawingPanel/styles/global.css"),__webpack_require__("./src/DrawingPanel/styles/list.css"),__webpack_require__("./src/DrawingPanel/styles/inputs.css"),react_default.a.forwardRef((function DrawingPanelForwardRef(_ref,ref){var style=_ref.style,canvasContainerRef=Object(react.useRef)(null),_useState=Object(react.useState)(0),_useState2=Object(slicedToArray.a)(_useState,2),loadProgress=_useState2[0],setLoadProgress=_useState2[1],_useState3=Object(react.useState)(0),_useState4=Object(slicedToArray.a)(_useState3,2),loadTotal=_useState4[0],setLoadTotal=_useState4[1],onProgressCallback=function onProgressCallback(progress,total){console.log("Loaded ".concat((progress/total*100).toFixed(2),"%, ").concat(progress," of ").concat(total,".")),setLoadProgress(progress),setLoadTotal(total),progress===total&&(dispatch({type:"scene",subtype:"EDIT_SELECTCLR"}),zoomToFit())};!function useDrop(container,onDrop,onProgressCallback){function handleDragEnter(e){container.current&&(e.preventDefault(),e.stopPropagation(),container.current.classList.add("dragOver"))}function handleDragOver(e){container.current&&(e.preventDefault(),e.stopPropagation(),container.current.classList.add("dragOver"))}function handleDragLeave(e){container.current&&(e.preventDefault(),e.stopPropagation(),container.current.classList.remove("dragOver"))}function handleDrop(e){container.current&&onDrop(e,container.current,onProgressCallback)}Object(react.useEffect)((function(){container.current&&(container.current.addEventListener("dragenter",handleDragEnter),container.current.addEventListener("dragleave",handleDragLeave),container.current.addEventListener("dragover",handleDragOver),container.current.addEventListener("drop",handleDrop))}),[])}(canvasContainerRef,onDrop_onDrop,onProgressCallback);var _useState5=Object(react.useState)({scene:sceneInit,ui:uiInit,history:historyInit}),_useState6=Object(slicedToArray.a)(_useState5,2),state=_useState6[0],setState=_useState6[1];Object(react.useEffect)((function(){if(canvasContainerRef.current)return function initDraw(_setScene){if("undefined"!=typeof window){store=Object(redux.b)(reducers_reducer,initialState,Object(redux.a)(middleWare)),draw_state=store.getState(),dispatch=store.dispatch,store.subscribe((function(){return draw_state=store.getState()})),setParentState=_setScene;var canvasContainer=document.querySelector("#canvas-container"),textCanvas=document.querySelector("#text");if(ctx=textCanvas.getContext("2d"),draw_canvas=document.querySelector("#c"),gl=draw_canvas.getContext("webgl2",{premultipliedAlpha:!1,colorSpace:"display-p3"}),twgl_full_module.n({attribPrefix:"a_"}),twgl_full_module.k(gl.canvas),twgl_full_module.k(ctx.canvas),draw_resolution=new primitives_vec(draw_canvas.clientWidth,draw_canvas.clientHeight),dispatch(function cursorGridScale(_int2){return{type:"cursor",subtype:"CURSOR_GRIDSCALE",int:_int2}}(32)),dispatch(function cursorGrid(scale){return{type:"cursor",subtype:"CURSOR_GRID",scale:scale}}(32)),draw_view={minX:(0-draw_dPt[0])*(32/draw_dPt[2]),minY:(0-draw_dPt[1])*(32/draw_dPt[2]),maxX:draw_resolution.x/draw_resolution.y*(32/draw_dPt[2])-draw_dPt[0],maxY:32/draw_dPt[2]*1-draw_dPt[1]},gl){glyphs=[],dispatch(scenePushEditItem(new primitives_prim("polyline",[],propsDefault))),draw_ui=new gesture_DrawUI,draw_updateDataStructures(store.getState()),canvasContainer.onwheel=scrollPan;var texMatrix=twgl_full_module.j.identity(),gridUniforms={u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_dPt:draw_dPt},gridLayer=new glyph_Glyph({type:"grid"},simpleVert,"#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\n\nfloat gridMnr(float x) { return abs(fract(x*0.5+0.5)-0.5) * 2.; }\n\nvoid main() {\n  // outColor = vec4(1.00);\n\n  vec2 uv = v_texcoord;\n  \n  uv.x *= u_resolution.x / u_resolution.y;\n  uv -= u_dPt.xy;\n  uv *= u_dPt.z / 32.;\n\n  uv *= 32.;\n\n  vec2 q = v_texcoord;\n\n  //https://www.shadertoy.com/view/XtVcWc - beautiful grid\n  \n  // red lines\n  // vec3(x) is background color\n  vec3 col = vec3(1.0) - smoothstep( (u_dPt.z * 0.001),0.0, abs(gridMnr(uv.x)))*vec3(.25,0.15,0.02);\n  col -= smoothstep((u_dPt.z * 0.001), 0.0, abs(gridMnr(uv.y)))*vec3(.25,0.15,0.02);\n  \n  // blue lines\n  col -= (smoothstep( (u_dPt.z * 0.00015),0.0, abs(gridMnr(uv.x / 12.)))*vec3(0.,0.77,0.7)) * 0.25;\n  col -= (smoothstep((u_dPt.z * 0.00015), 0.0, abs(gridMnr(uv.y / 12.)))*vec3(0.,0.77,0.7)) * 0.25;\n  \n  // subtle paper texture\n  //col *= (smoothstep(0.26,.25,(fract(sin(dot(uv.x, uv.y))*150130.1)))*0.03+0.97)*vec3(1.005,1.,0.99);\n  //vignette\n  //col *= clamp(pow( 256.0*q.x*q.y*(1.0-q.x)*(1.0-q.y), .09 ),0.,1.)*.325+0.7;\n\n  outColor = vec4(col,1.0);\n}",-1,gridUniforms);glyphs.push(gridLayer),gridLayer.active=draw_state.ui.showGrid;var uiUniforms={u_textureMatrix:twgl_full_module.j.copy(texMatrix),u_resolution:twgl_full_module.q.create(gl.canvas.width,gl.canvas.height,0),u_dPt:draw_dPt,u_mPt:draw_mPt,u_eTex:{},u_weight:.001,u_stroke:chroma_default()("#ffa724").gl().slice(0,3),u_boxSel:twgl_full_module.q.create(),u_boxState:draw_state.ui.boxSelectState},uiLayer=new glyph_Glyph({type:"ui"},simpleVert,"#version 300 es\n#define saturate(a) clamp(a, 0.0, 1.0)\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform vec3 u_resolution;\nuniform vec3 u_dPt;\n\nuniform vec3 u_mPt;\n\nuniform sampler2D u_eTex;\n// uniform sampler2D u_distTex;\n\nuniform float u_weight;\nuniform vec3 u_stroke;\nuniform float u_opacity;\n\nuniform vec3 u_boxSel;\nuniform float u_boxState;\n\n// out vec4 outColor;\nlayout(location = 0) out vec4 outColor;\n\n\nfloat sdCircle(vec2 uv, vec2 p, float r){\n  uv = uv - p;\n  return length(uv) - r;\n}\n\n\n//uv, p translation point, b 1/2 length, width, r radius\nfloat sdBox( in vec2 uv, in vec2 p, in vec2 b , in float r)\n{\n    b -= r;\n    uv = (uv-p);\n    vec2 d = abs(uv)-b;\n    return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0) - r;\n}\n\n\nfloat line(float d, float w){\n  d = clamp(abs(d) - w, 0.0, 1.0);\n  d = 1.0 - smoothstep(0.0, 0.003, abs(d));\n  return d;\n}\n\n\nvec3 drawPt(vec2 uv, vec2 p, float dist, vec3 col){\n  vec3 color = mix(col, vec3(1.0, 0.25, 0.25), dist);\n  return color;\n}\n\n\n  vec2 invTransformPt(vec2 pt) {\n    pt *= 32. / u_dPt.z;\n    pt += u_dPt.xy;\n    // pt.x *= u_resolution.y / u_resolution.x;\n    return pt;\n  }\n\n\nvoid main(){\n  outColor = vec4(1.0);\n  vec2 uv = v_texcoord;\n  uv.x *= u_resolution.x / u_resolution.y;\n\n  float texelOffset = 0.5 * (1. / (16. * 16.));\n\n  vec2 mousePt = invTransformPt(u_mPt.xy);\n\n  // vec2 index = u_mPt.xy;\n  // index.y = 1.0 - index.y;\n  // float radius = (texture(u_distTex, index).x - 0.5) * u_resolution.x / u_resolution.y;\n\n  float dist = line(sdCircle(uv, mousePt, 0.008 + u_weight), 0.00075);\n\n  vec2 boxPt = invTransformPt(u_boxSel.xy);\n\n  vec2 center = 0.5 * (mousePt - boxPt) + boxPt;\n  vec2 rPt = abs(mousePt - center);\n  float box = sdBox(uv, center, rPt, 0.001);\n\n  float stroke = line(box, 0.0);\n  vec3 strokeCol = mix(vec3(1.), vec3(0.2745, 0.5098, 0.7059), stroke);\n  strokeCol *= u_boxState;\n  \n  dist = max(dist, min(stroke, u_boxState));\n\n  vec3 col = mix(vec3(1.0),u_stroke, dist);\n\n  if ( dist < 0.0001) discard;\n\n  outColor = vec4(col, dist);\n}",1e4,uiUniforms);glyphs.push(uiLayer),distTex=twgl_full_module.e(gl,{level:0,width:gl.canvas.width,height:gl.canvas.height,min:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE}),sceneTex=twgl_full_module.e(gl,{level:0,width:gl.canvas.width,height:gl.canvas.height,min:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE}),distBuffer=twgl_full_module.c(gl,[{attachment:sceneTex,attachmentPoint:gl.COLOR_ATTACHMENT0},{attachment:distTex,attachmentPoint:gl.COLOR_ATTACHMENT1}],gl.canvas.width,gl.canvas.height),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),requestAnimationFrame(render)}else console.log("your browser/OS/drivers do not support WebGL2")}}(setState),function(){console.log("cleanup"),function cleanupWebGL(){dispatch({type:"scene",subtype:"SCENE_CLEAR"});var loseContext=gl.getExtension("WEBGL_lose_context");loseContext&&loseContext.loseContext()}()}}),[]);var currentItem=Object(react.useMemo)((function(){return state.scene.editItems.find((function(i){return i.id===state.scene.editItem}))}),[state.scene]),currentProperties=Object(react.useMemo)((function(){return currentItem?currentItem.properties:void 0}),[currentItem]),getDrawingContent=Object(react.useCallback)((function(){var json=serializeScene();return JSON.stringify(json)}),[]),getDrawingScreenshot=Object(react.useCallback)((function(filename,_formData){screenshotDirect((function(blob){return blob}))}),[]);return Object(react.useImperativeHandle)(ref,(function api(){return{getDrawingContent:getDrawingContent,getDrawingScreenshot:getDrawingScreenshot,loadScene:function loadScene(data){return io_loadScene(data,onProgressCallback)}}}),[getDrawingContent,getDrawingScreenshot]),react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("div",{className:"flex-row",style:Object(objectSpread2.a)(Object(objectSpread2.a)({},style),{},{height:"100%",position:"relative",alignItems:"start"})},react_default.a.createElement(AlignSider_AlignSider,{state:state,style:{flex:4,border:"1px solid var(--color-grey3)",borderRadius:8,minWidth:200}}),react_default.a.createElement("div",{className:"flex-column",style:{height:"100%",flex:20}},react_default.a.createElement("div",{id:"drawing-panel",className:"flex-column",style:{height:"100%",width:"100%",transform:open?void 0:"translateX(65vw)",zIndex:11,pointerEvents:"auto",gap:0}},react_default.a.createElement(AlignToolbar_AlignToolbar,{state:state}),react_default.a.createElement(ContextMenu_ContextMenu,{trigger:react_default.a.createElement("div",{id:"canvas-container",ref:canvasContainerRef,style:{height:"100%",width:"100%",backgroundColor:"white",position:"relative",borderRadius:8,border:"1px solid var(--color-warmblue)"}},loadTotal>0&&loadProgress<loadTotal&&react_default.a.createElement(index_module.b,{value:loadProgress,max:loadTotal,getValueLabel:function getValueLabel(value,max){return"Loaded ".concat((value/max*100).toFixed(2),"%, ").concat(value," loaded of ").concat(max," total.")},style:{height:8,minHeight:8,margin:"4px 8px 0px 8px",position:"absolute",width:"calc(100% - 16px)",zIndex:10,overflow:"hidden",borderRadius:999,backgroundColor:"white",border:"1px solid var(--color-warmblue)"}},react_default.a.createElement(index_module.a,{style:{height:"100%",width:"100%",backgroundColor:"var(--color-warmblue)",transform:"translateX(-".concat(100-loadProgress/loadTotal*100,"%)")}})),react_default.a.createElement("canvas",{id:"c",className:"canvas",style:{height:"100%",width:"100%",borderRadius:"inherit",position:"absolute"}}),react_default.a.createElement("canvas",{id:"text",className:"canvas",style:{height:"100%",width:"100%",borderRadius:"inherit",position:"absolute"}}))},react_default.a.createElement("div",{className:"flex-column",style:{gap:8}},react_default.a.createElement("div",{className:"flex-column",style:{gap:4}},react_default.a.createElement("div",{className:"flex-column",style:{gap:4}},react_default.a.createElement(InputLabel_InputLabel,{label:"Stroke Width"}),react_default.a.createElement(Slider_Slider,{value:currentProperties?[1e4*currentProperties.weight]:[0],onValueChange:function onValueChange(value){var weight=value[0]/1e4;dispatch(function editWeight(weight,id){return{type:"scene",subtype:"EDIT_WEIGHT",weight:weight,id:id}}(weight,state.scene.editItem))},sliderProps:{min:1}})),react_default.a.createElement("div",{className:"flex-column",style:{gap:4}},react_default.a.createElement(InputLabel_InputLabel,{label:"Opacity"}),react_default.a.createElement(Slider_Slider,{value:currentProperties?[100*currentProperties.opacity]:[0],onValueChange:function onValueChange(value){var opacity=value[0]/100;dispatch(function editOpacity(opacity,id){return{type:"scene",subtype:"EDIT_OPACITY",opacity:opacity,id:id}}(opacity,state.scene.editItem))},sliderProps:{min:1}}))),react_default.a.createElement("div",{className:"flex-row"},react_default.a.createElement("div",{className:"flex-column",style:{gap:4}},react_default.a.createElement(InputLabel_InputLabel,{label:"Stroke"}),react_default.a.createElement("div",{className:"flex-row",style:{gap:4,alignItems:"center"}},react_default.a.createElement(ColorPicker_ColorPicker,{value:currentProperties&&currentProperties.stroke,onChange:function onChange(val){dispatch(editStroke(val,state.scene.editItem))},style:{width:46,height:46}}))),react_default.a.createElement("div",{className:"flex-column",style:{gap:4}},react_default.a.createElement(InputLabel_InputLabel,{label:"Fill"}),react_default.a.createElement("div",{className:"flex-row",style:{gap:4,alignItems:"center"}},react_default.a.createElement(ColorPicker_ColorPicker,{value:currentProperties&&currentProperties.fill,onChange:function onChange(val){dispatch(function editFill(hex,id){return{type:"scene",subtype:"EDIT_FILL",hex:hex,id:id}}(val,state.scene.editItem))},style:{width:46,height:46},disabled:currentItem&&"polyline"===currentItem.type})))))))),react_default.a.createElement("a",{id:"downloadAnchor",style:{display:"none"}})))}))),Default=(__webpack_exports__.default={title:"Drawing Panel",component:DrawingPanel},function Template(args){return react_default.a.createElement("div",{style:{display:"grid",height:"100%"}}," ",react_default.a.createElement(DrawingPanel,args)," ")}.bind({}));Default.args={foo:"bar"}},"./src/DrawingPanel/styles/align.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/align.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/DrawingPanel/styles/buttons.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/buttons.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/DrawingPanel/styles/editor.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/editor.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/DrawingPanel/styles/flex.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/flex.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/DrawingPanel/styles/global.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/global.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/DrawingPanel/styles/inputs.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/inputs.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/DrawingPanel/styles/list.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/list.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./src/DrawingPanel/styles/menu.css":function(module,exports,__webpack_require__){var api=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),content=__webpack_require__("./node_modules/@storybook/builder-webpack4/node_modules/css-loader/dist/cjs.js?!./node_modules/@storybook/builder-webpack4/node_modules/postcss-loader/dist/cjs.js?!./src/DrawingPanel/styles/menu.css");"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},"./storybook-init-framework-entry.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js")},0:function(module,exports,__webpack_require__){__webpack_require__("./node_modules/@storybook/core-client/dist/esm/globals/polyfills.js"),__webpack_require__("./node_modules/@storybook/core-client/dist/esm/globals/globals.js"),__webpack_require__("./storybook-init-framework-entry.js"),__webpack_require__("./node_modules/@storybook/react/dist/esm/client/preview/config-generated-config-entry.js"),__webpack_require__("./.storybook/preview.js-generated-config-entry.js"),module.exports=__webpack_require__("./generated-stories-entry.js")},1:function(module,exports){}},[[0,2,3]]]);